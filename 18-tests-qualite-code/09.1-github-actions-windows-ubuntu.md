ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 18.9.1 GitHub Actions Windows/Ubuntu

## Introduction Ã  l'IntÃ©gration Continue avec GitHub Actions

### Qu'est-ce que GitHub Actions ?

GitHub Actions est un service d'intÃ©gration continue et de dÃ©ploiement continu (CI/CD) intÃ©grÃ© directement Ã  GitHub. Il permet d'automatiser des tÃ¢ches comme :

- **Compiler votre code** automatiquement Ã  chaque modification
- **ExÃ©cuter les tests** pour vÃ©rifier que rien n'est cassÃ©
- **VÃ©rifier la qualitÃ© du code** (linting, analyse statique)
- **DÃ©ployer l'application** automatiquement sur les serveurs
- **GÃ©nÃ©rer des rapports** de couverture de code
- **CrÃ©er des releases** et des packages

### Pourquoi utiliser GitHub Actions pour FreePascal ?

**Avantages :**

âœ… **Gratuit pour les projets open source** (et gÃ©nÃ©reux pour les projets privÃ©s)  
âœ… **IntÃ©grÃ© Ã  GitHub** : pas besoin de service externe  
âœ… **Multi-plateforme** : teste facilement sur Windows, Linux et macOS  
âœ… **ParallÃ©lisation** : teste sur plusieurs OS simultanÃ©ment  
âœ… **Automatisation complÃ¨te** : moins d'erreurs humaines  
âœ… **Historique des builds** : trace de toutes les compilations

**Cas d'usage typiques :**

1. **DÃ©veloppeur solo** : vÃ©rifier que le code compile sur les deux OS
2. **Ã‰quipe** : s'assurer qu'un commit ne casse pas le build
3. **Projet open source** : garantir la qualitÃ© avant d'accepter une Pull Request
4. **Production** : dÃ©ployer automatiquement aprÃ¨s validation

---

## Concepts de Base

### Anatomie d'un Workflow GitHub Actions

Un workflow GitHub Actions est dÃ©fini dans un fichier YAML situÃ© dans `.github/workflows/`.

**Structure de base :**

```yaml
name: Nom du Workflow          # Nom affichÃ© dans l'interface
on: [push, pull_request]       # Quand le workflow se dÃ©clenche
jobs:                          # Liste des tÃ¢ches Ã  exÃ©cuter
  build:                       # Nom du job
    runs-on: ubuntu-latest     # Sur quel OS exÃ©cuter
    steps:                     # Liste des Ã©tapes
      - name: PremiÃ¨re Ã©tape   # Nom de l'Ã©tape
        run: echo "Hello"      # Commande Ã  exÃ©cuter
```

### Ã‰lÃ©ments ClÃ©s

#### 1. DÃ©clencheurs (Triggers)

**Les Ã©vÃ©nements qui lancent le workflow :**

```yaml
# DÃ©clencher sur push
on: push

# DÃ©clencher sur plusieurs Ã©vÃ©nements
on: [push, pull_request]

# DÃ©clencher sur des branches spÃ©cifiques
on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
```

#### 2. Jobs

**UnitÃ©s de travail qui s'exÃ©cutent (par dÃ©faut en parallÃ¨le) :**

```yaml
jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Compilation Windows
        run: fpc MonProgramme.pas

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - name: Compilation Linux
        run: fpc MonProgramme.pas
```

Ces deux jobs s'exÃ©cutent **en parallÃ¨le** sur deux machines virtuelles diffÃ©rentes.

#### 3. Steps (Ã‰tapes)

**Actions individuelles dans un job :**

```yaml
steps:
  - name: RÃ©cupÃ©rer le code
    uses: actions/checkout@v3

  - name: Installer FreePascal
    run: sudo apt install fpc

  - name: Compiler
    run: fpc MonProgramme.pas
```

#### 4. Runners (Machines d'ExÃ©cution)

**OS disponibles :**

- `ubuntu-latest` (Ubuntu 22.04)
- `ubuntu-20.04` (version spÃ©cifique)
- `windows-latest` (Windows Server 2022)
- `windows-2019` (version spÃ©cifique)
- `macos-latest` (macOS 12+)

---

## Installation de FreePascal dans GitHub Actions

### Sur Ubuntu

```yaml
jobs:
  build-ubuntu:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Installer FreePascal
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: VÃ©rifier l'installation
        run: fpc -iV
```

**Explication :**
- `sudo apt-get update` : met Ã  jour la liste des packages
- `sudo apt-get install -y fpc` : installe FreePascal (l'option `-y` Ã©vite la confirmation)
- `fpc -iV` : affiche la version installÃ©e

### Sur Windows

```yaml
jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Installer FreePascal avec Chocolatey
        run: choco install freepascal -y

      - name: VÃ©rifier l'installation
        run: fpc -iV
```

**Explication :**
- `choco install freepascal -y` : utilise Chocolatey (gestionnaire de packages Windows)
- L'option `-y` accepte automatiquement les confirmations

### Installation de Lazarus (si nÃ©cessaire)

#### Ubuntu
```yaml
- name: Installer Lazarus
  run: |
    sudo apt-get install -y lazarus lcl
```

#### Windows
```yaml
- name: Installer Lazarus
  run: choco install lazarus -y
```

---

## Premier Workflow Complet : Build Multi-Plateforme

### CrÃ©er le Fichier de Workflow

**Emplacement :** `.github/workflows/build.yml`

```yaml
name: Build FreePascal Multi-Plateforme

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  # Job 1: Compilation sur Ubuntu
  build-ubuntu:
    runs-on: ubuntu-latest

    steps:
    - name: RÃ©cupÃ©ration du code source
      uses: actions/checkout@v3

    - name: Installation de FreePascal
      run: |
        sudo apt-get update
        sudo apt-get install -y fpc

    - name: Affichage de la version FPC
      run: fpc -iV

    - name: Compilation du projet
      run: |
        cd src
        fpc -O2 -gl MonProgramme.pas

    - name: VÃ©rification de l'exÃ©cutable
      run: |
        test -f src/MonProgramme
        echo "âœ… Compilation Ubuntu rÃ©ussie"

  # Job 2: Compilation sur Windows
  build-windows:
    runs-on: windows-latest

    steps:
    - name: RÃ©cupÃ©ration du code source
      uses: actions/checkout@v3

    - name: Installation de FreePascal
      run: choco install freepascal -y

    - name: Affichage de la version FPC
      run: fpc -iV

    - name: Compilation du projet
      run: |
        cd src
        fpc -O2 -gl MonProgramme.pas

    - name: VÃ©rification de l'exÃ©cutable
      run: |
        if (Test-Path src\MonProgramme.exe) {
          Write-Host "âœ… Compilation Windows rÃ©ussie"
        } else {
          Write-Error "âŒ ExÃ©cutable non trouvÃ©"
          exit 1
        }
      shell: pwsh
```

### Comprendre ce Workflow

**DÃ©clencheurs :**
- S'exÃ©cute sur chaque `push` vers les branches `main` ou `develop`
- S'exÃ©cute sur chaque `pull_request` vers `main`

**Deux jobs en parallÃ¨le :**
1. **build-ubuntu** : compile sur Ubuntu
2. **build-windows** : compile sur Windows

**Ã‰tapes communes :**
1. RÃ©cupÃ¨re le code avec `actions/checkout@v3`
2. Installe FreePascal (diffÃ©remment selon l'OS)
3. Affiche la version pour vÃ©rification
4. Compile le projet
5. VÃ©rifie que l'exÃ©cutable existe

---

## Workflow AvancÃ© : Tests Automatiques

### Avec FPCUnit

```yaml
name: Tests FPCUnit

on: [push, pull_request]

jobs:
  test-ubuntu:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Installation FPC et FPCUnit
      run: |
        sudo apt-get update
        sudo apt-get install -y fpc fpcunit

    - name: Compilation des tests
      run: |
        cd tests
        fpc -Fu../src -gl TestsSuite.pas

    - name: ExÃ©cution des tests
      run: |
        cd tests
        ./TestsSuite --format=plain

    - name: VÃ©rification du rÃ©sultat
      run: |
        if [ $? -eq 0 ]; then
          echo "âœ… Tous les tests passent"
        else
          echo "âŒ Des tests ont Ã©chouÃ©"
          exit 1
        fi

  test-windows:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v3

    - name: Installation FPC
      run: choco install freepascal -y

    - name: Compilation des tests
      run: |
        cd tests
        fpc -Fu..\src -gl TestsSuite.pas

    - name: ExÃ©cution des tests
      run: |
        cd tests
        .\TestsSuite.exe --format=plain

    - name: VÃ©rification du rÃ©sultat
      shell: pwsh
      run: |
        if ($LASTEXITCODE -eq 0) {
          Write-Host "âœ… Tous les tests passent"
        } else {
          Write-Error "âŒ Des tests ont Ã©chouÃ©"
          exit 1
        }
```

---

## Matrice de Build : Tester Plusieurs Configurations

### Concept de Matrice

Une matrice permet de tester automatiquement plusieurs combinaisons de paramÃ¨tres (OS, versions, options).

### Exemple : Plusieurs Versions de FreePascal

```yaml
name: Matrice Multi-Versions

on: [push, pull_request]

jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        fpc-version: ['3.2.0', '3.2.2']

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v3

    - name: Installation FPC ${{ matrix.fpc-version }} sur ${{ matrix.os }}
      if: runner.os == 'Linux'
      run: |
        # Script d'installation selon la version
        echo "Installation de FPC ${{ matrix.fpc-version }}"
        sudo apt-get update
        sudo apt-get install -y fpc

    - name: Installation FPC ${{ matrix.fpc-version }} sur ${{ matrix.os }}
      if: runner.os == 'Windows'
      run: choco install freepascal -y

    - name: Compilation
      run: fpc -O2 MonProgramme.pas
```

**RÃ©sultat :** Ce workflow crÃ©e **4 jobs** automatiquement :
1. Ubuntu + FPC 3.2.0
2. Ubuntu + FPC 3.2.2
3. Windows + FPC 3.2.0
4. Windows + FPC 3.2.2

### Matrice avec Exclusions

```yaml
strategy:
  matrix:
    os: [ubuntu-latest, windows-latest, macos-latest]
    fpc-version: ['3.2.0', '3.2.2']
    exclude:
      # Exclure macOS + FPC 3.2.0 (non supportÃ©)
      - os: macos-latest
        fpc-version: '3.2.0'
```

---

## Gestion des Artefacts (Artifacts)

### Qu'est-ce qu'un Artefact ?

Un artefact est un fichier gÃ©nÃ©rÃ© par votre workflow (exÃ©cutable, rapport, logs) que vous pouvez tÃ©lÃ©charger ou rÃ©utiliser.

### Sauvegarder les ExÃ©cutables

```yaml
name: Build et Sauvegarde des ExÃ©cutables

on: [push]

jobs:
  build-and-upload:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v3

    - name: Installer FPC
      run: |
        if [ "$RUNNER_OS" == "Linux" ]; then
          sudo apt-get update && sudo apt-get install -y fpc
        elif [ "$RUNNER_OS" == "Windows" ]; then
          choco install freepascal -y
        fi
      shell: bash

    - name: Compiler
      run: fpc -O2 MonProgramme.pas

    - name: Upload de l'exÃ©cutable Ubuntu
      if: runner.os == 'Linux'
      uses: actions/upload-artifact@v3
      with:
        name: MonProgramme-Linux
        path: MonProgramme

    - name: Upload de l'exÃ©cutable Windows
      if: runner.os == 'Windows'
      uses: actions/upload-artifact@v3
      with:
        name: MonProgramme-Windows
        path: MonProgramme.exe
```

**RÃ©sultat :** AprÃ¨s le build, vous pouvez tÃ©lÃ©charger `MonProgramme-Linux` et `MonProgramme-Windows` depuis l'interface GitHub Actions.

### TÃ©lÃ©charger un Artefact dans un Autre Job

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Compiler
        run: fpc MonProgramme.pas
      - name: Upload
        uses: actions/upload-artifact@v3
        with:
          name: executable
          path: MonProgramme

  test:
    needs: build  # Attend que 'build' soit terminÃ©
    runs-on: ubuntu-latest
    steps:
      - name: TÃ©lÃ©charger l'exÃ©cutable
        uses: actions/download-artifact@v3
        with:
          name: executable

      - name: Rendre exÃ©cutable
        run: chmod +x MonProgramme

      - name: ExÃ©cuter les tests
        run: ./MonProgramme --run-tests
```

---

## Workflows Conditionnels

### ExÃ©cuter Seulement sur Certaines Branches

```yaml
name: Deploy Production

on:
  push:
    branches:
      - main  # Seulement sur la branche main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: DÃ©ploiement
        run: echo "DÃ©ploiement en production"
```

### Conditions au Niveau des Steps

```yaml
steps:
  - name: Ã‰tape qui s'exÃ©cute seulement sur Linux
    if: runner.os == 'Linux'
    run: echo "Je suis sur Linux"

  - name: Ã‰tape qui s'exÃ©cute seulement sur Windows
    if: runner.os == 'Windows'
    run: echo "Je suis sur Windows"

  - name: Ã‰tape qui s'exÃ©cute seulement sur la branche main
    if: github.ref == 'refs/heads/main'
    run: echo "Je suis sur main"

  - name: Ã‰tape qui s'exÃ©cute seulement sur les tags
    if: startsWith(github.ref, 'refs/tags/')
    run: echo "C'est un tag de version"
```

### ExÃ©cuter sur Pull Request Uniquement

```yaml
name: Validation PR

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: VÃ©rifier le code
        run: |
          fpc -gl -Ci src/*.pas
          echo "âœ… Code valide"
```

---

## Cache pour AccÃ©lÃ©rer les Builds

### Mise en Cache des DÃ©pendances

Le cache permet de rÃ©utiliser des fichiers entre les exÃ©cutions pour gagner du temps.

```yaml
name: Build avec Cache

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Cache des packages FPC
      uses: actions/cache@v3
      with:
        path: |
          ~/.fpc
          /usr/lib/fpc
        key: ${{ runner.os }}-fpc-${{ hashFiles('**/fpc.cfg') }}
        restore-keys: |
          ${{ runner.os }}-fpc-

    - name: Installer FPC
      run: sudo apt-get install -y fpc

    - name: Compiler
      run: fpc -O2 MonProgramme.pas
```

**Avantages :**
- Premier build : installe FPC normalement (~2 minutes)
- Builds suivants : utilise le cache (~10 secondes)

---

## Variables d'Environnement et Secrets

### Variables d'Environnement

```yaml
jobs:
  build:
    runs-on: ubuntu-latest

    env:
      FPC_VERSION: 3.2.2
      BUILD_CONFIG: Release

    steps:
    - name: Utiliser les variables
      run: |
        echo "Version FPC: $FPC_VERSION"
        echo "Configuration: $BUILD_CONFIG"
        fpc -O2 -dRELEASE MonProgramme.pas
```

### Secrets (DonnÃ©es Sensibles)

**Pour stocker des mots de passe, clÃ©s API, etc.**

**1. Ajouter un secret dans GitHub :**
- Allez dans `Settings â†’ Secrets and variables â†’ Actions`
- Cliquez sur `New repository secret`
- Nom : `DEPLOY_TOKEN`, Valeur : `votre_token_secret`

**2. Utiliser le secret dans le workflow :**

```yaml
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: DÃ©ployer avec token
      run: |
        echo "DÃ©ploiement avec token sÃ©curisÃ©"
        curl -H "Authorization: Bearer ${{ secrets.DEPLOY_TOKEN }}" \
             https://api.example.com/deploy
```

**Important :** Les secrets ne sont JAMAIS affichÃ©s dans les logs !

---

## Workflow Complet : Pipeline CI/CD Professionnel

### Structure du Projet

```
mon-projet/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci-cd.yml
â”œâ”€â”€ src/
â”‚   â””â”€â”€ MonProgramme.pas
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ TestsSuite.pas
â””â”€â”€ README.md
```

### Fichier ci-cd.yml Complet

```yaml
name: Pipeline CI/CD FreePascal

on:
  push:
    branches: [ main, develop ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main ]

env:
  FPC_VERSION: 3.2.2

jobs:
  # Job 1: VÃ©rification du code
  lint:
    name: Analyse statique du code
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Installer FPC
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: VÃ©rifier la syntaxe
        run: |
          find src -name "*.pas" -exec fpc -S {} \;

  # Job 2: Build multi-plateforme
  build:
    name: Compilation ${{ matrix.os }}
    needs: lint
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]
        include:
          - os: ubuntu-latest
            executable: MonProgramme
          - os: windows-latest
            executable: MonProgramme.exe

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      - name: Installer FPC (Linux)
        if: runner.os == 'Linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: Installer FPC (Windows)
        if: runner.os == 'Windows'
        run: choco install freepascal -y

      - name: Compiler le projet
        run: |
          cd src
          fpc -O2 -gl -Ci MonProgramme.pas

      - name: Upload de l'exÃ©cutable
        uses: actions/upload-artifact@v3
        with:
          name: MonProgramme-${{ runner.os }}
          path: src/${{ matrix.executable }}

  # Job 3: Tests automatiques
  test:
    name: Tests ${{ matrix.os }}
    needs: build
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      - name: TÃ©lÃ©charger l'exÃ©cutable
        uses: actions/download-artifact@v3
        with:
          name: MonProgramme-${{ runner.os }}
          path: ./bin

      - name: Rendre exÃ©cutable (Linux)
        if: runner.os == 'Linux'
        run: chmod +x bin/MonProgramme

      - name: Installer FPC
        run: |
          if [ "$RUNNER_OS" == "Linux" ]; then
            sudo apt-get update && sudo apt-get install -y fpc fpcunit
          elif [ "$RUNNER_OS" == "Windows" ]; then
            choco install freepascal -y
          fi
        shell: bash

      - name: Compiler les tests
        run: |
          cd tests
          fpc -Fu../src -gl TestsSuite.pas

      - name: ExÃ©cuter les tests
        run: |
          cd tests
          if [ "$RUNNER_OS" == "Linux" ]; then
            ./TestsSuite --format=plain
          else
            ./TestsSuite.exe --format=plain
          fi
        shell: bash

  # Job 4: Release automatique (seulement sur tags)
  release:
    name: CrÃ©er une Release
    if: startsWith(github.ref, 'refs/tags/v')
    needs: [build, test]
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: TÃ©lÃ©charger tous les artefacts
        uses: actions/download-artifact@v3

      - name: CrÃ©er l'archive Linux
        run: |
          cd MonProgramme-Linux
          tar -czf ../MonProgramme-Linux-${{ github.ref_name }}.tar.gz *

      - name: CrÃ©er l'archive Windows
        run: |
          cd MonProgramme-Windows
          zip -r ../MonProgramme-Windows-${{ github.ref_name }}.zip *

      - name: CrÃ©er la Release GitHub
        uses: softprops/action-gh-release@v1
        with:
          files: |
            MonProgramme-Linux-${{ github.ref_name }}.tar.gz
            MonProgramme-Windows-${{ github.ref_name }}.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### FonctionnalitÃ©s de ce Pipeline

**1. Analyse statique** (`lint`)
- VÃ©rifie la syntaxe de tous les fichiers `.pas`
- S'exÃ©cute en premier pour dÃ©tecter rapidement les erreurs

**2. Compilation multi-plateforme** (`build`)
- Compile sur Ubuntu et Windows en parallÃ¨le
- Sauvegarde les exÃ©cutables comme artefacts
- Utilise une matrice pour Ã©viter la duplication

**3. Tests automatiques** (`test`)
- TÃ©lÃ©charge les exÃ©cutables compilÃ©s
- Compile et exÃ©cute la suite de tests FPCUnit
- Valide sur les deux plateformes

**4. Release automatique** (`release`)
- S'exÃ©cute seulement quand vous crÃ©ez un tag (ex: `v1.0.0`)
- CrÃ©e des archives `.tar.gz` et `.zip`
- Publie automatiquement une Release GitHub avec les binaires

---

## Badge de Statut dans le README

Ajoutez un badge pour montrer l'Ã©tat de votre build :

```markdown
# Mon Projet FreePascal

![Build Status](https://github.com/username/repo/workflows/CI-CD/badge.svg)
```

Le badge affichera :
- âœ… Vert si le build passe
- âŒ Rouge si le build Ã©choue
- ğŸŸ¡ Jaune si le build est en cours

---

## DÃ©bogage des Workflows

### Afficher des Informations de Debug

```yaml
steps:
  - name: Debug - Informations systÃ¨me
    run: |
      echo "OS: $RUNNER_OS"
      echo "Architecture: $RUNNER_ARCH"
      echo "Workspace: $GITHUB_WORKSPACE"
      echo "Branch: $GITHUB_REF"
      echo "Commit: $GITHUB_SHA"

  - name: Debug - Lister les fichiers
    run: |
      ls -la
      pwd
```

### Activer le Mode Debug

Dans GitHub :
1. Allez dans `Settings â†’ Secrets and variables â†’ Actions`
2. Ajoutez deux secrets :
   - `ACTIONS_RUNNER_DEBUG` = `true`
   - `ACTIONS_STEP_DEBUG` = `true`

Les logs afficheront beaucoup plus de dÃ©tails.

### Tester Localement avec act

`act` permet d'exÃ©cuter GitHub Actions localement :

```bash
# Installation (Linux)
curl https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash

# ExÃ©cuter le workflow localement
act -j build
```

---

## Bonnes Pratiques

### 1. Nommer Clairement les Jobs et Steps

âŒ **Mauvais :**
```yaml
steps:
  - name: Step 1
    run: fpc test.pas
```

âœ… **Bon :**
```yaml
steps:
  - name: Compilation des tests unitaires
    run: fpc -Fu../src tests/TestsSuite.pas
```

### 2. Utiliser fail-fast Intelligemment

```yaml
strategy:
  fail-fast: false  # Continue mÃªme si un job Ã©choue
  matrix:
    os: [ubuntu-latest, windows-latest]
```

Sans `fail-fast: false`, si Windows Ã©choue, Ubuntu est annulÃ© automatiquement.

### 3. SÃ©parer Build et Test

```yaml
jobs:
  build:
    # Compile le code

  test:
    needs: build  # Attend la fin du build
    # ExÃ©cute les tests
```

Avantage : en cas d'Ã©chec de compilation, les tests ne s'exÃ©cutent pas inutilement.

### 4. Versionner les Actions

âœ… **Bon :**
```yaml
- uses: actions/checkout@v3  # Version fixe
```

âŒ **RisquÃ© :**
```yaml
- uses: actions/checkout@main  # Peut changer sans prÃ©venir
```

### 5. Nettoyer les Artefacts

Les artefacts consomment de l'espace de stockage :

```yaml
- name: Upload de l'exÃ©cutable
  uses: actions/upload-artifact@v3
  with:
    name: executable
    path: MonProgramme
    retention-days: 7  # Supprimer aprÃ¨s 7 jours
```

### 6. Utiliser des Scripts pour le Code Complexe

Au lieu de mettre beaucoup de lignes `run:`, crÃ©ez un script :

**scripts/build.sh :**
```bash
#!/bin/bash
set -e

echo "Compilation en cours..."
cd src
fpc -O2 -gl MonProgramme.pas
echo "âœ… Compilation rÃ©ussie"
```

**Workflow :**
```yaml
steps:
  - name: Compiler
    run: bash scripts/build.sh
```

---

## Limites et Quotas

### Limites Gratuites (par mois)

| Type de Compte | Minutes Gratuites | Espace Artefacts |
|----------------|-------------------|------------------|
| Public (open source) | IllimitÃ© | 500 MB |
| PrivÃ© (Free) | 2000 minutes | 500 MB |
| PrivÃ© (Pro) | 3000 minutes | 1 GB |
| PrivÃ© (Team) | 3000 minutes | 2 GB |

### Multiplicateurs par OS

| OS | Multiplicateur |
|----|----------------|
| Linux | 1x |
| Windows | 2x |
| macOS | 10x |

**Exemple :** Un build de 10 minutes sur Windows compte comme **20 minutes**.

### Optimiser la Consommation

1. **Utiliser le cache** pour rÃ©duire les temps de build
2. **PrivilÃ©gier Linux** quand c'est possible
3. **ParallÃ©liser intelligemment** sans abus
4. **Nettoyer les artefacts** rÃ©guliÃ¨rement

---

## Cas d'Usage AvancÃ©s

### Build Conditionnel selon le Message de Commit

```yaml
jobs:
  build:
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build
        run: fpc MonProgramme.pas
```

Si votre commit contient `[skip ci]`, le build est ignorÃ©.

### Notifications Slack/Discord

```yaml
jobs:
  notify:
    runs-on: ubuntu-latest
    if: always()  # S'exÃ©cute mÃªme si les autres jobs Ã©chouent
    needs: [build, test]
    steps:
      - name: Notifier sur Discord
        if: failure()
        run: |
          curl -X POST ${{ secrets.DISCORD_WEBHOOK }} \
            -H "Content-Type: application/json" \
            -d '{"content":"âŒ Build Ã©chouÃ© pour ${{ github.repository }}"}'

      - name: Notifier sur Slack
        if: success()
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -H "Content-Type: application/json" \
            -d '{
              "text": "âœ… Build rÃ©ussi pour ${{ github.repository }}",
              "attachments": [{
                "color": "good",
                "fields": [{
                  "title": "Branche",
                  "value": "${{ github.ref_name }}",
                  "short": true
                }, {
                  "title": "Commit",
                  "value": "${{ github.sha }}",
                  "short": true
                }]
              }]
            }'
```

**Configuration :**
1. CrÃ©ez un webhook dans Discord/Slack
2. Ajoutez-le comme secret : `DISCORD_WEBHOOK` ou `SLACK_WEBHOOK`
3. Le workflow envoie automatiquement des notifications

---

## DÃ©ploiement Automatique

### DÃ©ploiement sur un Serveur Linux via SSH

```yaml
name: DÃ©ploiement Production

on:
  push:
    branches:
      - main
    tags:
      - 'v*'

jobs:
  deploy:
    name: DÃ©ployer sur serveur Linux
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du code
        uses: actions/checkout@v3

      - name: Installer FreePascal
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: Compiler pour production
        run: |
          cd src
          fpc -O3 -XXs -CX MonProgramme.pas

      - name: CrÃ©er l'archive de dÃ©ploiement
        run: |
          mkdir -p deploy
          cp src/MonProgramme deploy/
          cp -r config deploy/
          tar -czf deploy.tar.gz deploy/

      - name: DÃ©ployer via SSH
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          source: "deploy.tar.gz"
          target: "/tmp/"

      - name: Extraire et redÃ©marrer le service
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ${{ secrets.DEPLOY_USER }}
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          script: |
            cd /opt/monapp
            sudo systemctl stop monapp
            tar -xzf /tmp/deploy.tar.gz
            cp -r deploy/* .
            sudo systemctl start monapp
            sudo systemctl status monapp
            rm -rf /tmp/deploy.tar.gz deploy/
```

**Secrets nÃ©cessaires :**
- `DEPLOY_HOST` : IP ou nom d'hÃ´te du serveur
- `DEPLOY_USER` : Nom d'utilisateur SSH
- `DEPLOY_SSH_KEY` : ClÃ© privÃ©e SSH (format PEM)

### DÃ©ploiement sur un Serveur Windows

```yaml
jobs:
  deploy-windows:
    name: DÃ©ployer sur serveur Windows
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      - name: Compiler
        run: |
          choco install freepascal -y
          cd src
          fpc -O3 MonProgramme.pas

      - name: Copier vers le serveur
        run: |
          # Utiliser WinSCP ou PowerShell Remoting
          $secPassword = ConvertTo-SecureString "${{ secrets.DEPLOY_PASSWORD }}" -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential("${{ secrets.DEPLOY_USER }}", $secPassword)

          $session = New-PSSession -ComputerName ${{ secrets.DEPLOY_HOST }} -Credential $credential

          Copy-Item -Path "src\MonProgramme.exe" `
                    -Destination "C:\Apps\MonApp\" `
                    -ToSession $session

          Invoke-Command -Session $session -ScriptBlock {
            Stop-Service -Name "MonAppService"
            Start-Service -Name "MonAppService"
          }

          Remove-PSSession $session
        shell: pwsh
```

---

## DÃ©ploiement Docker Multi-Plateforme

### CrÃ©er et Publier des Images Docker

```yaml
name: Docker Build et Push

on:
  push:
    branches: [ main ]
    tags: [ 'v*' ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build-docker:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Login vers GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata
        id: meta
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}
          tags: |
            type=ref,event=branch
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}

      - name: Build et Push image Docker
        uses: docker/build-push-action@v4
        with:
          context: .
          platforms: linux/amd64,linux/arm64
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
```

**Dockerfile FreePascal :**

```dockerfile
# Dockerfile
FROM ubuntu:22.04 as builder

# Installer FreePascal
RUN apt-get update && \
    apt-get install -y fpc && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /build

# Copier le code source
COPY src/ ./src/

# Compiler
RUN cd src && fpc -O3 -XXs MonProgramme.pas

# Image finale lÃ©gÃ¨re
FROM ubuntu:22.04

RUN apt-get update && \
    apt-get install -y ca-certificates && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copier l'exÃ©cutable compilÃ©
COPY --from=builder /build/src/MonProgramme .

# Copier les fichiers de configuration
COPY config/ ./config/

# Exposition du port (si applicable)
EXPOSE 8080

# Commande de dÃ©marrage
CMD ["./MonProgramme"]
```

---

## Tests de Performance AutomatisÃ©s

### Benchmark et Mesure de Performance

```yaml
name: Tests de Performance

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  benchmark:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Installer FreePascal
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc

      - name: Compiler avec optimisations
        run: |
          cd src
          fpc -O3 -Xs MonProgramme.pas

      - name: ExÃ©cuter les benchmarks
        run: |
          ./src/MonProgramme --benchmark > benchmark_results.txt
          cat benchmark_results.txt

      - name: Analyser les rÃ©sultats
        run: |
          # Extraire le temps d'exÃ©cution
          TIME=$(grep "Temps total:" benchmark_results.txt | awk '{print $3}')
          echo "Temps d'exÃ©cution: $TIME secondes"

          # Comparer avec la baseline
          BASELINE=10.0
          if (( $(echo "$TIME > $BASELINE" | bc -l) )); then
            echo "âš ï¸ Performance dÃ©gradÃ©e: $TIME s (baseline: $BASELINE s)"
            exit 1
          else
            echo "âœ… Performance acceptable: $TIME s"
          fi

      - name: Upload des rÃ©sultats
        uses: actions/upload-artifact@v3
        with:
          name: benchmark-results
          path: benchmark_results.txt

      - name: Commenter la PR avec les rÃ©sultats
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const results = fs.readFileSync('benchmark_results.txt', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## ğŸ“Š RÃ©sultats des Benchmarks\n\`\`\`\n${results}\n\`\`\``
            });
```

---

## Analyse de SÃ©curitÃ© et QualitÃ© du Code

### Scanner de VulnÃ©rabilitÃ©s

```yaml
name: Analyse de SÃ©curitÃ©

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Scan hebdomadaire le lundi Ã  9h
    - cron: '0 9 * * 1'

jobs:
  security-scan:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Scanner les dÃ©pendances
        run: |
          # Rechercher les bibliothÃ¨ques connues avec vulnÃ©rabilitÃ©s
          echo "Analyse des dÃ©pendances..."
          find . -name "*.pas" -exec grep -l "uses.*SysUtils" {} \;

      - name: Analyser le code pour les patterns dangereux
        run: |
          echo "Recherche de patterns de code dangereux..."

          # Rechercher les commandes shell potentiellement dangereuses
          if grep -r "ShellExecute\|Exec\|System(" src/; then
            echo "âš ï¸ Commandes shell dÃ©tectÃ©es - vÃ©rifier la sÃ©curitÃ©"
          fi

          # Rechercher les allocations mÃ©moire non libÃ©rÃ©es
          if grep -r "GetMem\|New(" src/ | grep -v "FreeMem\|Dispose"; then
            echo "âš ï¸ Allocations mÃ©moire potentiellement non libÃ©rÃ©es"
          fi

      - name: VÃ©rifier les permissions de fichiers
        run: |
          # S'assurer qu'aucun fichier exÃ©cutable n'est commitÃ© par erreur
          find . -type f -perm /111 ! -name "*.sh" | grep -v ".git" || true
```

### Analyse de la ComplexitÃ© du Code

```yaml
jobs:
  code-quality:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Installer les outils d'analyse
        run: |
          sudo apt-get update
          sudo apt-get install -y fpc cloc

      - name: Statistiques du code
        run: |
          echo "## ğŸ“Š Statistiques du Code" > code_stats.md
          echo "" >> code_stats.md
          cloc src/ --md >> code_stats.md
          cat code_stats.md

      - name: Analyser la complexitÃ©
        run: |
          # Compter les fonctions longues (>100 lignes)
          echo "Recherche de fonctions trop longues..."
          for file in src/*.pas; do
            awk '/^(function|procedure)/{start=NR} /^end;/{
              if (NR-start > 100)
                print FILENAME ":" start " - Fonction trop longue (" NR-start " lignes)"
            }' "$file"
          done

      - name: VÃ©rifier les standards de code
        run: |
          # VÃ©rifier l'indentation
          echo "VÃ©rification de l'indentation..."
          find src/ -name "*.pas" -exec grep -n "^[^ ]" {} + | grep -v "^[^:]*:[0-9]*:(uses\|type\|var\|const\|begin\|end)" || true

      - name: Commenter la PR
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const stats = fs.readFileSync('code_stats.md', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: stats
            });
```

---

## Documentation Automatique

### GÃ©nÃ©rer et Publier la Documentation

```yaml
name: Documentation

on:
  push:
    branches: [ main ]

jobs:
  generate-docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Installer PasDoc
        run: |
          sudo apt-get update
          sudo apt-get install -y pasdoc

      - name: GÃ©nÃ©rer la documentation
        run: |
          mkdir -p docs/api
          pasdoc \
            --source src/ \
            --output docs/api/ \
            --format html \
            --title "Documentation API - Mon Projet" \
            --introduction README.md

      - name: CrÃ©er l'index de documentation
        run: |
          cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
            <title>Documentation - Mon Projet FreePascal</title>
            <meta charset="UTF-8">
            <style>
              body { font-family: Arial, sans-serif; margin: 40px; }
              h1 { color: #333; }
              .link-box {
                background: #f5f5f5;
                padding: 20px;
                margin: 10px 0;
                border-radius: 5px;
              }
            </style>
          </head>
          <body>
            <h1>ğŸ“š Documentation - Mon Projet FreePascal</h1>
            <div class="link-box">
              <h2>ğŸ”— Liens Utiles</h2>
              <ul>
                <li><a href="api/">Documentation API</a></li>
                <li><a href="https://github.com/${{ github.repository }}">Code Source</a></li>
                <li><a href="https://github.com/${{ github.repository }}/releases">Releases</a></li>
              </ul>
            </div>
          </body>
          </html>
          EOF

      - name: DÃ©ployer sur GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          publish_branch: gh-pages
```

**Configuration GitHub Pages :**
1. Allez dans `Settings â†’ Pages`
2. Source : `Deploy from a branch`
3. Branch : `gh-pages` / `root`
4. Votre documentation sera accessible Ã  `https://username.github.io/repo/`

---

## Gestion des Versions Automatique

### Semantic Versioning et Changelog

```yaml
name: Release Automatique

on:
  push:
    branches: [ main ]

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # RÃ©cupÃ¨re tout l'historique git

      - name: Analyser les commits
        id: semantic
        uses: paulhatch/semantic-version@v5.0.2
        with:
          tag_prefix: "v"
          major_pattern: "(BREAKING CHANGE|MAJOR)"
          minor_pattern: "(feat|FEATURE)"
          patch_pattern: "(fix|bugfix|patch)"
          format: "${major}.${minor}.${patch}"

      - name: GÃ©nÃ©rer le changelog
        id: changelog
        run: |
          PREVIOUS_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "")

          if [ -z "$PREVIOUS_TAG" ]; then
            COMMITS=$(git log --pretty=format:"- %s (%h)" --no-merges)
          else
            COMMITS=$(git log ${PREVIOUS_TAG}..HEAD --pretty=format:"- %s (%h)" --no-merges)
          fi

          echo "CHANGELOG<<EOF" >> $GITHUB_OUTPUT
          echo "## Version ${{ steps.semantic.outputs.version }}" >> $GITHUB_OUTPUT
          echo "" >> $GITHUB_OUTPUT
          echo "### Changements :" >> $GITHUB_OUTPUT
          echo "$COMMITS" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Compiler les binaires
        run: |
          sudo apt-get update && sudo apt-get install -y fpc
          cd src
          fpc -O3 MonProgramme.pas

      - name: CrÃ©er le tag
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git tag -a "v${{ steps.semantic.outputs.version }}" -m "Release v${{ steps.semantic.outputs.version }}"
          git push origin "v${{ steps.semantic.outputs.version }}"

      - name: CrÃ©er la Release GitHub
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.semantic.outputs.version }}
          name: Release v${{ steps.semantic.outputs.version }}
          body: ${{ steps.changelog.outputs.CHANGELOG }}
          draft: false
          prerelease: false
          files: |
            src/MonProgramme
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

**Convention de commits pour semantic versioning :**

```
feat: Nouvelle fonctionnalitÃ©       â†’ Version mineure (1.0.0 â†’ 1.1.0)
fix: Correction de bug               â†’ Version patch (1.0.0 â†’ 1.0.1)
BREAKING CHANGE: Changement majeur   â†’ Version majeure (1.0.0 â†’ 2.0.0)
```

---

## Workflows RÃ©utilisables

### CrÃ©er un Workflow RÃ©utilisable

**Fichier `.github/workflows/build-reusable.yml` :**

```yaml
name: Build RÃ©utilisable

on:
  workflow_call:
    inputs:
      os:
        required: true
        type: string
      fpc-version:
        required: false
        type: string
        default: 'latest'
      build-config:
        required: false
        type: string
        default: 'Release'
    outputs:
      artifact-name:
        description: "Nom de l'artefact crÃ©Ã©"
        value: ${{ jobs.build.outputs.artifact }}

jobs:
  build:
    runs-on: ${{ inputs.os }}
    outputs:
      artifact: ${{ steps.upload.outputs.artifact-name }}

    steps:
      - uses: actions/checkout@v3

      - name: Installer FPC (${{ inputs.os }})
        run: |
          if [ "$RUNNER_OS" == "Linux" ]; then
            sudo apt-get update && sudo apt-get install -y fpc
          elif [ "$RUNNER_OS" == "Windows" ]; then
            choco install freepascal -y
          fi
        shell: bash

      - name: Compiler (${{ inputs.build-config }})
        run: |
          cd src
          if [ "${{ inputs.build-config }}" == "Release" ]; then
            fpc -O3 -XXs MonProgramme.pas
          else
            fpc -g -gl MonProgramme.pas
          fi
        shell: bash

      - name: Upload artefact
        id: upload
        uses: actions/upload-artifact@v3
        with:
          name: MonProgramme-${{ runner.os }}-${{ inputs.build-config }}
          path: src/MonProgramme*
```

### Utiliser le Workflow RÃ©utilisable

**Fichier `.github/workflows/main.yml` :**

```yaml
name: Pipeline Principal

on: [push, pull_request]

jobs:
  build-linux-debug:
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: ubuntu-latest
      build-config: Debug

  build-linux-release:
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: ubuntu-latest
      build-config: Release

  build-windows-release:
    uses: ./.github/workflows/build-reusable.yml
    with:
      os: windows-latest
      build-config: Release
```

**Avantages :**
- âœ… Ã‰vite la duplication de code
- âœ… Maintenance centralisÃ©e
- âœ… RÃ©utilisable dans plusieurs workflows

---

## StratÃ©gies de Tests AvancÃ©es

### Tests ParamÃ©trÃ©s avec Matrice Dynamique

```yaml
name: Tests ParamÃ©trÃ©s

on: [push, pull_request]

jobs:
  prepare-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}

    steps:
      - uses: actions/checkout@v3

      - name: GÃ©nÃ©rer la matrice de test
        id: set-matrix
        run: |
          # Lire les configurations depuis un fichier JSON
          MATRIX=$(cat .github/test-matrix.json | jq -c .)
          echo "matrix=$MATRIX" >> $GITHUB_OUTPUT

  test:
    needs: prepare-matrix
    strategy:
      matrix: ${{ fromJson(needs.prepare-matrix.outputs.matrix) }}

    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      - name: Test ${{ matrix.test-name }}
        run: |
          echo "ExÃ©cution du test: ${{ matrix.test-name }}"
          echo "ParamÃ¨tres: ${{ matrix.params }}"
```

**Fichier `.github/test-matrix.json` :**

```json
{
  "include": [
    {
      "os": "ubuntu-latest",
      "test-name": "Performance Tests",
      "params": "--benchmark"
    },
    {
      "os": "ubuntu-latest",
      "test-name": "Integration Tests",
      "params": "--integration"
    },
    {
      "os": "windows-latest",
      "test-name": "UI Tests",
      "params": "--ui-tests"
    }
  ]
}
```

---

## Gestion des Erreurs et Retry

### RÃ©essayer en Cas d'Ã‰chec

```yaml
jobs:
  build-with-retry:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Compiler avec retry
        uses: nick-invision/retry@v2
        with:
          timeout_minutes: 10
          max_attempts: 3
          retry_wait_seconds: 30
          command: |
            sudo apt-get update
            sudo apt-get install -y fpc
            cd src
            fpc -O2 MonProgramme.pas

      - name: Tests avec retry
        uses: nick-invision/retry@v2
        with:
          timeout_minutes: 5
          max_attempts: 2
          command: |
            ./tests/run_tests.sh
```

### Continue-on-error pour les Jobs Optionnels

```yaml
jobs:
  mandatory-build:
    runs-on: ubuntu-latest
    steps:
      - name: Build principal
        run: fpc MonProgramme.pas

  optional-benchmark:
    runs-on: ubuntu-latest
    continue-on-error: true  # N'arrÃªte pas le workflow si ce job Ã©choue
    steps:
      - name: Benchmark
        run: ./benchmark.sh

  deployment:
    needs: mandatory-build  # N'attend PAS optional-benchmark
    runs-on: ubuntu-latest
    steps:
      - name: DÃ©ployer
        run: ./deploy.sh
```

---

## Workflows Composites

### CrÃ©er une Action Composite RÃ©utilisable

**Fichier `.github/actions/setup-fpc/action.yml` :**

```yaml
name: 'Setup FreePascal'
description: 'Installe FreePascal avec cache'

inputs:
  version:
    description: 'Version de FPC Ã  installer'
    required: false
    default: 'latest'
  cache:
    description: 'Activer le cache'
    required: false
    default: 'true'

outputs:
  fpc-version:
    description: 'Version de FPC installÃ©e'
    value: ${{ steps.get-version.outputs.version }}

runs:
  using: 'composite'
  steps:
    - name: Cache FPC
      if: inputs.cache == 'true'
      uses: actions/cache@v3
      with:
        path: |
          ~/.fpc
          /usr/lib/fpc
        key: ${{ runner.os }}-fpc-${{ inputs.version }}

    - name: Installer FPC (Linux)
      if: runner.os == 'Linux'
      run: sudo apt-get update && sudo apt-get install -y fpc
      shell: bash

    - name: Installer FPC (Windows)
      if: runner.os == 'Windows'
      run: choco install freepascal -y
      shell: pwsh

    - name: Obtenir la version
      id: get-version
      run: echo "version=$(fpc -iV)" >> $GITHUB_OUTPUT
      shell: bash
```

### Utiliser l'Action Composite

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup FreePascal
        uses: ./.github/actions/setup-fpc
        with:
          version: 'latest'
          cache: 'true'

      - name: Compiler
        run: fpc MonProgramme.pas
```

---

## Conclusion et Bonnes Pratiques Finales

### Checklist pour un Workflow de QualitÃ©

âœ… **Organisation**
- [ ] Noms de workflows explicites
- [ ] Jobs bien sÃ©parÃ©s (build/test/deploy)
- [ ] Commentaires dans les fichiers YAML complexes

âœ… **Performance**
- [ ] Cache activÃ© pour les dÃ©pendances
- [ ] ParallÃ©lisation des jobs indÃ©pendants
- [ ] Artefacts nettoyÃ©s automatiquement

âœ… **SÃ©curitÃ©**
- [ ] Secrets utilisÃ©s pour les donnÃ©es sensibles
- [ ] Pas de secrets dans les logs
- [ ] Permissions minimales pour les tokens

âœ… **QualitÃ©**
- [ ] Tests automatiques Ã  chaque commit
- [ ] Couverture de code mesurÃ©e
- [ ] DÃ©ploiement uniquement aprÃ¨s validation

âœ… **Maintenance**
- [ ] Versions fixÃ©es pour les actions (`@v3` au lieu de `@main`)
- [ ] Documentation du workflow
- [ ] Notifications configurÃ©es

### Ressources Utiles

**Documentation officielle :**
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Marketplace GitHub Actions](https://github.com/marketplace?type=actions)
- [Awesome Actions](https://github.com/sdras/awesome-actions)

**Actions populaires pour FreePascal :**
- `actions/checkout@v3` - RÃ©cupÃ©rer le code
- `actions/upload-artifact@v3` - Sauvegarder les artefacts
- `actions/cache@v3` - Mise en cache
- `softprops/action-gh-release@v1` - CrÃ©er des releases

### Exemple de Projet Complet

Pour un projet FreePascal professionnel, voici une structure recommandÃ©e :

```
.github/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ ci.yml              # Build et tests continus
â”‚   â”œâ”€â”€ release.yml         # CrÃ©ation de releases
â”‚   â”œâ”€â”€ documentation.yml   # GÃ©nÃ©ration de docs
â”‚   â””â”€â”€ security.yml        # Scans de sÃ©curitÃ©
â”œâ”€â”€ actions/
â”‚   â””â”€â”€ setup-fpc/          # Action composite rÃ©utilisable
â”‚       â””â”€â”€ action.yml
â””â”€â”€ test-matrix.json        # Configuration des tests

src/
tests/
docs/
scripts/
```

Avec GitHub Actions, vous automatisez complÃ¨tement votre workflow de dÃ©veloppement FreePascal, du commit au dÃ©ploiement, sur Windows et Ubuntu en parallÃ¨le ! ğŸš€

â­ï¸ [GitLab CI avec runners multi-OS](/18-tests-qualite-code/09.2-gitlab-ci-runners-multi-os.md)
