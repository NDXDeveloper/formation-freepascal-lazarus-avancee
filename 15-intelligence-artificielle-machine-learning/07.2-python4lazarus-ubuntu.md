üîù Retour au [Sommaire](/SOMMAIRE.md)

# 15.7.2 Python4Lazarus sur Ubuntu

## Introduction

Cette section vous guide dans l'installation et la configuration de Python4Lazarus sur Ubuntu/Linux. Vous d√©couvrirez les sp√©cificit√©s de l'environnement Linux, les diff√©rences avec Windows, et comment tirer parti des outils natifs d'Ubuntu pour cr√©er des applications d'Intelligence Artificielle performantes.

## Pourquoi Ubuntu pour l'IA ?

Ubuntu est devenu la plateforme de r√©f√©rence pour le d√©veloppement en Intelligence Artificielle :

### Avantages d'Ubuntu pour l'IA

‚úÖ **√âcosyst√®me natif** : Python et biblioth√®ques IA sont con√ßus pour Linux  
‚úÖ **Performance** : Meilleure gestion m√©moire, moins d'overhead syst√®me  
‚úÖ **Outils de d√©veloppement** : apt, pip, conda int√©gr√©s nativement  
‚úÖ **Serveurs** : Facilit√© de d√©ploiement sur serveurs Linux  
‚úÖ **Docker/Conteneurs** : Support natif pour le d√©ploiement conteneuris√©  
‚úÖ **GPU** : Meilleure int√©gration CUDA/NVIDIA pour le deep learning

### Diff√©rences principales avec Windows

| Aspect | Windows | Ubuntu/Linux |
|--------|---------|--------------|
| **S√©parateur de chemin** | `\` (backslash) | `/` (forward slash) |
| **Biblioth√®ques dynamiques** | `.dll` | `.so` (shared object) |
| **Gestionnaire de paquets** | pip, chocolatey | apt, pip, snap |
| **Permissions** | UAC | chmod, sudo |
| **Python par d√©faut** | Non install√© | Pr√©-install√© (3.x) |
| **Chemins syst√®me** | `C:\Program Files` | `/usr/lib`, `/usr/local` |

## Pr√©requis

### 1. V√©rifier votre syst√®me Ubuntu

Ouvrez un terminal (Ctrl+Alt+T) et v√©rifiez votre version :

```bash
lsb_release -a
```

**Sortie attendue :**
```
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.3 LTS
Release:        22.04
Codename:       jammy
```

Cette section est test√©e sur Ubuntu 20.04, 22.04 et 24.04 LTS.

### 2. V√©rifier l'installation de Python

Ubuntu vient g√©n√©ralement avec Python 3 pr√©-install√© :

```bash
python3 --version
```

**Sortie attendue :**
```
Python 3.10.12
```

Si Python n'est pas install√© (rare), installez-le :

```bash
sudo apt update
sudo apt install python3 python3-pip python3-dev
```

### 3. Installer Lazarus et FreePascal

**M√©thode 1 : Via les d√©p√¥ts Ubuntu (stable)**

```bash
sudo apt update
sudo apt install lazarus lcl fp-compiler fp-units-misc
```

**M√©thode 2 : Via le PPA (version plus r√©cente)**

```bash
sudo add-apt-repository ppa:lazarus-team/lazarus
sudo apt update
sudo apt install lazarus
```

**V√©rifier l'installation :**

```bash
lazarus-ide --version
fpc -iV
```

### 4. Identifier les chemins Python importants

**Chemin de l'ex√©cutable Python :**

```bash
which python3
```

**Sortie typique :**
```
/usr/bin/python3
```

**Chemin des biblioth√®ques Python :**

```bash
python3 -c "import sys; print(sys.executable)"
python3 -c "import sysconfig; print(sysconfig.get_config_var('LIBDIR'))"
```

**Sortie typique :**
```
/usr/bin/python3
/usr/lib/x86_64-linux-gnu
```

**Trouver libpython3.X.so :**

```bash
find /usr/lib -name "libpython3*.so*" 2>/dev/null
```

**Sortie typique :**
```
/usr/lib/x86_64-linux-gnu/libpython3.10.so
/usr/lib/x86_64-linux-gnu/libpython3.10.so.1
/usr/lib/x86_64-linux-gnu/libpython3.10.so.1.0
```

**Notez ces chemins, ils seront n√©cessaires pour la configuration !**

## Installation de Python4Lazarus

### M√©thode 1 : Installation via OPM (Recommand√©e)

**√âtape 1 : Lancer Lazarus**

```bash
lazarus-ide
```

Ou depuis le menu Applications ‚Üí D√©veloppement ‚Üí Lazarus

**√âtape 2 : Ouvrir OPM (Online Package Manager)**

1. Menu **Paquets ‚Üí Gestionnaire de paquets en ligne**
2. Attendez le chargement de la liste

**√âtape 3 : Installer Python4Lazarus**

1. Recherchez "python" dans la barre de recherche
2. S√©lectionnez **Python4Lazarus** ou **python4delphi**
3. Cliquez sur **Installer**
4. Cliquez sur **Recompiler l'IDE**
5. Lazarus red√©marre automatiquement

**√âtape 4 : V√©rification**

Apr√®s le red√©marrage, v√©rifiez la pr√©sence de l'onglet **Python** dans la palette de composants avec :
- TPythonEngine
- TPythonModule
- TPythonInputOutput
- TPythonGUIInputOutput

### M√©thode 2 : Installation manuelle depuis GitHub

**√âtape 1 : T√©l√©charger Python4Delphi**

```bash
cd ~/Downloads
git clone https://github.com/pyscripter/python4delphi.git
```

Ou t√©l√©chargez le ZIP depuis GitHub et extrayez-le.

**√âtape 2 : Ouvrir le paquet dans Lazarus**

1. Lancez Lazarus
2. Menu **Paquet ‚Üí Ouvrir un fichier paquet (.lpk)**
3. Naviguez vers `~/Downloads/python4delphi/Packages/Lazarus/`
4. Ouvrez `python4lazarus_package.lpk`

**√âtape 3 : Compiler et installer**

1. Dans la fen√™tre du paquet, cliquez **Compiler**
2. Une fois la compilation r√©ussie, cliquez **Utiliser ‚Üí Installer**
3. Confirmez la recompilation de l'IDE
4. Lazarus red√©marre

**√âtape 4 : V√©rification**

V√©rifiez la pr√©sence des composants Python dans la palette.

## Configuration de base

### Cr√©er un premier projet test

**√âtape 1 : Nouveau projet**

1. **Projet ‚Üí Nouveau projet**
2. S√©lectionnez **Application**
3. Enregistrez : `TestPythonUbuntu.lpi`

**√âtape 2 : Ajouter les composants**

1. Onglet **Python** dans la palette
2. Ajoutez `TPythonEngine` sur le formulaire
3. Ajoutez `TPythonGUIInputOutput` sur le formulaire

**√âtape 3 : Ajouter l'interface utilisateur**

Ajoutez ces composants :
- 1 `TMemo` nomm√© `MemoCode` (pour le code Python)
- 1 `TButton` nomm√© `ButtonExecute` (Caption = "Ex√©cuter")
- 1 `TMemo` nomm√© `MemoOutput` (pour les r√©sultats)
- 1 `TLabel` nomm√© `LabelStatus`

**Disposition sugg√©r√©e :**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MemoCode (Code Python)                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ import sys                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ print(f"Python {sys.version}")    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ print("Hello from Ubuntu!")       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  [Ex√©cuter]  ‚Üê ButtonExecute            ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Status: ‚óè Pr√™t                         ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  MemoOutput (Sortie)                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Python 3.10.12                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ Hello from Ubuntu!                ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Configuration de TPythonEngine pour Ubuntu

S√©lectionnez `PythonEngine1` dans l'Object Inspector :

**Configuration automatique (recommand√©e) :**

```
Propri√©t√© : AutoLoad
Valeur   : True

Propri√©t√© : UseLastKnownVersion
Valeur   : True
```

Avec cette configuration, Python4Lazarus cherche automatiquement Python dans le syst√®me.

**Configuration manuelle (si automatique ne fonctionne pas) :**

```
Propri√©t√© : DllPath
Valeur   : /usr/lib/x86_64-linux-gnu

Propri√©t√© : DllName
Valeur   : libpython3.10.so
(Adaptez selon votre version Python)
```

**Configuration de PythonGUIInputOutput1 :**

```
Propri√©t√© : Engine
Valeur   : PythonEngine1
```

### Code Pascal complet

```pascal
unit Unit1;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, Forms, Controls, Graphics, Dialogs, StdCtrls,
  PythonEngine, PythonGUIInputOutput;

type
  TForm1 = class(TForm)
    ButtonExecute: TButton;
    LabelStatus: TLabel;
    MemoCode: TMemo;
    MemoOutput: TMemo;
    PythonEngine1: TPythonEngine;
    PythonGUIInputOutput1: TPythonGUIInputOutput;

    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure ButtonExecuteClick(Sender: TObject);
    procedure PythonGUIInputOutput1SendData(Sender: TObject; const Data: string);

  private
    procedure InitializePython;
    procedure UpdateStatus(const Msg: string; IsOK: Boolean);
  end;

var
  Form1: TForm1;

implementation

{$R *.lfm}

procedure TForm1.FormCreate(Sender: TObject);
begin
  InitializePython;

  // Code Python par d√©faut
  MemoCode.Lines.Clear;
  MemoCode.Lines.Add('import sys');
  MemoCode.Lines.Add('import platform');
  MemoCode.Lines.Add('');
  MemoCode.Lines.Add('print(f"Python {sys.version}")');
  MemoCode.Lines.Add('print(f"Plateforme : {platform.system()}")');
  MemoCode.Lines.Add('print("Hello from Ubuntu!")');
end;

procedure TForm1.FormDestroy(Sender: TObject);
begin
  if PythonEngine1.Initialized then
    PythonEngine1.Finalize;
end;

procedure TForm1.InitializePython;
begin
  try
    // Configuration pour Ubuntu
    {$IFDEF UNIX}
    PythonEngine1.UseLastKnownVersion := True;
    PythonEngine1.AutoLoad := True;
    {$ENDIF}

    // Charger Python
    PythonEngine1.LoadDll;

    if PythonEngine1.Initialized then
    begin
      UpdateStatus('Python ' + PythonEngine1.PyVersion + ' initialis√©', True);
      MemoOutput.Lines.Add('=== Python initialis√© avec succ√®s ===');
      MemoOutput.Lines.Add('Version : ' + PythonEngine1.PyVersion);

      // Afficher les chemins Python
      PythonEngine1.ExecString('import sys');
      MemoOutput.Lines.Add('Ex√©cutable : ' +
        PythonEngine1.EvalString('sys.executable'));

      ButtonExecute.Enabled := True;
    end
    else
    begin
      UpdateStatus('Erreur : Python non initialis√©', False);
      ShowMessage('Impossible d''initialiser Python. V√©rifiez l''installation.');
    end;

  except
    on E: Exception do
    begin
      UpdateStatus('Erreur : ' + E.Message, False);
      ShowMessage('Erreur lors de l''initialisation Python :' + LineEnding +
                  E.Message);
    end;
  end;
end;

procedure TForm1.ButtonExecuteClick(Sender: TObject);
begin
  if not PythonEngine1.Initialized then
  begin
    ShowMessage('Python n''est pas initialis√© !');
    Exit;
  end;

  MemoOutput.Clear;
  UpdateStatus('Ex√©cution en cours...', True);

  try
    PythonEngine1.ExecStrings(MemoCode.Lines);
    UpdateStatus('Ex√©cution termin√©e', True);
  except
    on E: Exception do
    begin
      UpdateStatus('Erreur d''ex√©cution', False);
      MemoOutput.Lines.Add('=== ERREUR ===');
      MemoOutput.Lines.Add(E.Message);
    end;
  end;
end;

procedure TForm1.PythonGUIInputOutput1SendData(Sender: TObject; const Data: string);
begin
  MemoOutput.Lines.Add(Data);
end;

procedure TForm1.UpdateStatus(const Msg: string; IsOK: Boolean);
begin
  LabelStatus.Caption := 'Status: ' + Msg;

  if IsOK then
  begin
    LabelStatus.Font.Color := clGreen;
    LabelStatus.Caption := LabelStatus.Caption + ' ‚óè';
  end
  else
  begin
    LabelStatus.Font.Color := clRed;
    LabelStatus.Caption := LabelStatus.Caption + ' ‚óè';
  end;
end;

end.
```

### Compiler et tester

**Compilation :**

1. **Lancer ‚Üí Compiler** (Ctrl+F9)
2. V√©rifiez qu'il n'y a pas d'erreurs

**Ex√©cution :**

1. **Lancer ‚Üí Ex√©cuter** (F9)
2. Cliquez sur **Ex√©cuter**
3. Vous devriez voir :

```
=== Python initialis√© avec succ√®s ===
Version : 3.10.12
Ex√©cutable : /usr/bin/python3
Python 3.10.12 (main, Nov 20 2023, 15:14:05) [GCC 11.4.0]
Plateforme : Linux
Hello from Ubuntu!
```

## Gestion des chemins et biblioth√®ques sur Ubuntu

### Comprendre les chemins Linux

Sur Ubuntu, les biblioth√®ques Python peuvent √™tre √† diff√©rents endroits :

**Chemins syst√®me standard :**

```
/usr/lib/python3.10/          # Biblioth√®que standard Python
/usr/lib/x86_64-linux-gnu/    # Biblioth√®ques compil√©es (.so)
/usr/local/lib/python3.10/    # Installations locales
/home/user/.local/lib/        # Installations utilisateur (pip install --user)
```

### D√©tection automatique de Python

**Code pour trouver automatiquement Python :**

```pascal
uses
  Process;

function FindPythonLibrary: string;
var
  Process: TProcess;
  OutputLines: TStringList;
  LibPath: string;
begin
  Result := '';

  Process := TProcess.Create(nil);
  OutputLines := TStringList.Create;
  try
    // Trouver le chemin de libpython
    Process.Executable := 'python3';
    Process.Parameters.Add('-c');
    Process.Parameters.Add(
      'import sysconfig; print(sysconfig.get_config_var("LIBDIR"))'
    );
    Process.Options := [poWaitOnExit, poUsePipes];
    Process.Execute;

    OutputLines.LoadFromStream(Process.Output);

    if OutputLines.Count > 0 then
    begin
      LibPath := Trim(OutputLines[0]);

      // Chercher libpython3.X.so
      if FileExists(LibPath + '/libpython3.10.so') then
        Result := LibPath + '/libpython3.10.so'
      else if FileExists(LibPath + '/libpython3.11.so') then
        Result := LibPath + '/libpython3.11.so'
      else if FileExists(LibPath + '/libpython3.9.so') then
        Result := LibPath + '/libpython3.9.so';
    end;

  finally
    OutputLines.Free;
    Process.Free;
  end;
end;

// Utilisation
procedure TForm1.FormCreate(Sender: TObject);
var
  PythonLib: string;
begin
  PythonLib := FindPythonLibrary;

  if PythonLib <> '' then
  begin
    PythonEngine1.DllPath := ExtractFilePath(PythonLib);
    PythonEngine1.DllName := ExtractFileName(PythonLib);
    PythonEngine1.LoadDll;
  end
  else
  begin
    // Utiliser la d√©tection automatique
    PythonEngine1.UseLastKnownVersion := True;
    PythonEngine1.LoadDll;
  end;
end;
```

### Gestion des erreurs courantes

**Erreur : "Could not load library libpython3.X.so"**

**Solution 1 : Installer les fichiers de d√©veloppement Python**

```bash
sudo apt install python3-dev
```

**Solution 2 : Cr√©er un lien symbolique**

Si vous avez `libpython3.10.so.1.0` mais pas `libpython3.10.so` :

```bash
cd /usr/lib/x86_64-linux-gnu
sudo ln -s libpython3.10.so.1.0 libpython3.10.so
```

**Solution 3 : V√©rifier ldconfig**

```bash
sudo ldconfig -v | grep python
```

Si la biblioth√®que n'appara√Æt pas, ajoutez-la :

```bash
echo "/usr/lib/x86_64-linux-gnu" | sudo tee /etc/ld.so.conf.d/python.conf
sudo ldconfig
```

## Installation de biblioth√®ques Python pour l'IA

### M√©thode 1 : Via pip (recommand√©e)

**Installer pip si n√©cessaire :**

```bash
sudo apt install python3-pip
```

**Installer les biblioth√®ques IA essentielles :**

```bash
# Biblioth√®ques de base
pip3 install numpy pandas matplotlib seaborn

# Machine Learning
pip3 install scikit-learn xgboost lightgbm

# Deep Learning
pip3 install tensorflow
# ou
pip3 install torch torchvision

# Computer Vision
pip3 install opencv-python pillow

# NLP
pip3 install transformers spacy nltk

# Jupyter (optionnel, pour prototypage)
pip3 install jupyter notebook
```

**Installation dans un environnement virtuel (recommand√©) :**

```bash
# Cr√©er un environnement virtuel
python3 -m venv ~/myenv

# Activer l'environnement
source ~/myenv/bin/activate

# Installer les biblioth√®ques
pip install tensorflow numpy pandas

# D√©sactiver
deactivate
```

### M√©thode 2 : Via apt (biblioth√®ques syst√®me)

Certaines biblioth√®ques sont disponibles via apt :

```bash
sudo apt install python3-numpy python3-pandas python3-matplotlib
sudo apt install python3-sklearn python3-opencv
```

**Avantages apt :**
- Int√©gration syst√®me optimale
- Gestion des d√©pendances automatique
- Mises √† jour syst√®me

**Inconv√©nients apt :**
- Versions souvent plus anciennes
- Moins de biblioth√®ques disponibles

### M√©thode 3 : Via Conda/Miniconda

**Installer Miniconda :**

```bash
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
```

**Cr√©er un environnement :**

```bash
conda create -n myenv python=3.10
conda activate myenv
conda install tensorflow numpy pandas scikit-learn
```

**Utiliser avec Python4Lazarus :**

```pascal
procedure TForm1.FormCreate(Sender: TObject);
begin
  // Pointer vers Python de conda
  PythonEngine1.DllPath := '/home/user/miniconda3/envs/myenv/lib';
  PythonEngine1.DllName := 'libpython3.10.so';
  PythonEngine1.LoadDll;

  if PythonEngine1.Initialized then
  begin
    // Configurer le path Python pour l'environnement conda
    PythonEngine1.ExecString('import sys');
    PythonEngine1.ExecString(
      'sys.path.insert(0, "/home/user/miniconda3/envs/myenv/lib/python3.10/site-packages")'
    );
  end;
end;
```

### V√©rifier les installations

**Test dans votre application Lazarus :**

```pascal
procedure TForm1.ButtonTestLibrariesClick(Sender: TObject);
var
  Libraries: array of string;
  i: Integer;
  Available, Missing: TStringList;
begin
  Libraries := ['numpy', 'pandas', 'matplotlib', 'sklearn', 'tensorflow'];

  Available := TStringList.Create;
  Missing := TStringList.Create;
  try
    for i := 0 to High(Libraries) do
    begin
      try
        PythonEngine1.ExecString('import ' + Libraries[i]);
        Available.Add(Libraries[i]);
      except
        Missing.Add(Libraries[i]);
      end;
    end;

    MemoOutput.Lines.Add('=== Biblioth√®ques disponibles ===');
    MemoOutput.Lines.AddStrings(Available);
    MemoOutput.Lines.Add('');

    if Missing.Count > 0 then
    begin
      MemoOutput.Lines.Add('=== Biblioth√®ques manquantes ===');
      MemoOutput.Lines.AddStrings(Missing);
      MemoOutput.Lines.Add('');
      MemoOutput.Lines.Add('Installez-les avec :');
      MemoOutput.Lines.Add('pip3 install ' + Missing.DelimitedText);
    end;

  finally
    Available.Free;
    Missing.Free;
  end;
end;
```

## Sp√©cificit√©s Ubuntu/Linux

### Permissions et sudo

Sur Ubuntu, certaines op√©rations n√©cessitent des privil√®ges administrateur :

**Cas 1 : Installation syst√®me**

```bash
# Installation globale (n√©cessite sudo)
sudo pip3 install tensorflow

# Installation utilisateur (sans sudo, recommand√©)
pip3 install --user tensorflow
```

**Cas 2 : Acc√®s aux p√©riph√©riques**

Pour acc√©der √† la cam√©ra, au GPU, etc. :

```bash
# Ajouter l'utilisateur au groupe video (pour cam√©ra)
sudo usermod -a -G video $USER

# Pour le GPU NVIDIA
sudo usermod -a -G video $USER
```

**D√©connectez-vous et reconnectez-vous** pour que les changements prennent effet.

### Variables d'environnement

**Configurer PYTHONPATH dans votre application :**

```pascal
procedure TForm1.SetupPythonEnvironment;
begin
  // Ajouter des chemins personnalis√©s
  PythonEngine1.ExecString('import sys');
  PythonEngine1.ExecString('import os');

  // Ajouter un chemin personnalis√©
  PythonEngine1.ExecString(
    'sys.path.insert(0, os.path.expanduser("~/mon_projet/python_scripts"))'
  );

  // D√©finir des variables d'environnement
  PythonEngine1.ExecString(
    'os.environ["CUDA_VISIBLE_DEVICES"] = "0"'  // Utiliser GPU 0
  );
end;
```

### Chemins relatifs et absolus

Sur Linux, utilisez toujours `/` comme s√©parateur :

```pascal
// ‚úÖ Correct sur Linux
PythonEngine.ExecString('data = load_file("/home/user/data.csv")');
PythonEngine.ExecString('img = load_image("./images/photo.jpg")');

// ‚úÖ Chemin utilisateur avec expansion
PythonEngine.ExecString('import os');
PythonEngine.ExecString('home = os.path.expanduser("~")');
PythonEngine.ExecString('file_path = os.path.join(home, "Documents", "data.csv")');

// ‚ùå √Ä √©viter (Windows style)
// PythonEngine.ExecString('data = load_file("C:\Users\data.csv")');
```

**Fonction Pascal pour g√©rer les chemins multi-plateformes :**

```pascal
function ToPythonPath(const Path: string): string;
begin
  {$IFDEF WINDOWS}
  Result := StringReplace(Path, '\', '/', [rfReplaceAll]);
  {$ELSE}
  Result := Path;
  {$ENDIF}
end;

// Utilisation
var
  DataPath: string;
begin
  DataPath := '/home/user/data.csv';
  PythonEngine.ExecString(
    Format('data = pd.read_csv("%s")', [ToPythonPath(DataPath)])
  );
end;
```

## Compilation conditionnelle Windows/Ubuntu

Pour cr√©er une application qui fonctionne sur les deux plateformes :

```pascal
unit CrossPlatformPython;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, PythonEngine;

type
  TCrossPlatformPython = class
  private
    FPythonEngine: TPythonEngine;
    procedure ConfigureForPlatform;
  public
    constructor Create(APythonEngine: TPythonEngine);
    function GetPythonPath: string;
    function GetLibraryName: string;
  end;

implementation

constructor TCrossPlatformPython.Create(APythonEngine: TPythonEngine);
begin
  FPythonEngine := APythonEngine;
  ConfigureForPlatform;
end;

procedure TCrossPlatformPython.ConfigureForPlatform;
begin
  {$IFDEF WINDOWS}
  // Configuration Windows
  FPythonEngine.DllPath := 'C:\Python310';
  FPythonEngine.DllName := 'python310.dll';
  {$ENDIF}

  {$IFDEF LINUX}
  // Configuration Linux/Ubuntu
  FPythonEngine.UseLastKnownVersion := True;
  FPythonEngine.AutoLoad := True;
  // ou sp√©cifique:
  // FPythonEngine.DllPath := '/usr/lib/x86_64-linux-gnu';
  // FPythonEngine.DllName := 'libpython3.10.so';
  {$ENDIF}

  {$IFDEF DARWIN}
  // Configuration macOS
  FPythonEngine.DllPath := '/usr/local/lib';
  FPythonEngine.DllName := 'libpython3.10.dylib';
  {$ENDIF}
end;

function TCrossPlatformPython.GetPythonPath: string;
begin
  {$IFDEF WINDOWS}
  Result := 'C:\Python310';
  {$ENDIF}

  {$IFDEF LINUX}
  Result := '/usr/bin/python3';
  {$ENDIF}

  {$IFDEF DARWIN}
  Result := '/usr/local/bin/python3';
  {$ENDIF}
end;

function TCrossPlatformPython.GetLibraryName: string;
begin
  {$IFDEF WINDOWS}
  Result := 'python310.dll';
  {$ENDIF}

  {$IFDEF LINUX}
  Result := 'libpython3.10.so';
  {$ENDIF}

  {$IFDEF DARWIN}
  Result := 'libpython3.10.dylib';
  {$ENDIF}
end;

end.
```

## Exemple complet : Application de classification d'images sur Ubuntu

```pascal
unit ImageClassifierUbuntu;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, Forms, Controls, Graphics, Dialogs, StdCtrls, ExtCtrls,
  ExtDlgs, PythonEngine, PythonGUIInputOutput;

type
  TFormClassifier = class(TForm)
    ButtonLoadModel: TButton;
    ButtonSelectImage: TButton;
    ButtonClassify: TButton;
    ImagePreview: TImage;
    LabelResult: TLabel;
    LabelStatus: TLabel;
    MemoLog: TMemo;
    OpenPictureDialog: TOpenPictureDialog;
    PythonEngine1: TPythonEngine;
    PythonGUIInputOutput1: TPythonGUIInputOutput;

    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure ButtonLoadModelClick(Sender: TObject);
    procedure ButtonSelectImageClick(Sender: TObject);
    procedure ButtonClassifyClick(Sender: TObject);
    procedure PythonGUIInputOutput1SendData(Sender: TObject; const Data: string);

  private
    FModelLoaded: Boolean;
    FCurrentImage: string;
    procedure InitializePython;
    procedure LoadModel;
    procedure ClassifyImage;
  end;

var
  FormClassifier: TFormClassifier;

implementation

{$R *.lfm}

procedure TFormClassifier.FormCreate(Sender: TObject);
begin
  FModelLoaded := False;
  FCurrentImage := '';
  InitializePython;
end;

procedure TFormClassifier.FormDestroy(Sender: TObject);
begin
  if PythonEngine1.Initialized then
    PythonEngine1.Finalize;
end;

procedure TFormClassifier.InitializePython;
begin
  try
    // Configuration Ubuntu
    {$IFDEF LINUX}
    PythonEngine1.UseLastKnownVersion := True;
    PythonEngine1.AutoLoad := True;
    {$ENDIF}

    PythonEngine1.LoadDll;

    if PythonEngine1.Initialized then
    begin
      LabelStatus.Caption := 'Python ' + PythonEngine1.PyVersion;
      LabelStatus.Font.Color := clGreen;

      MemoLog.Lines.Add('=== Initialisation Python ===');
      MemoLog.Lines.Add('Version : ' + PythonEngine1.PyVersion);

      // Afficher le syst√®me
      PythonEngine1.ExecString('import platform');
      MemoLog.Lines.Add('OS : ' + PythonEngine1.EvalString('platform.system()'));
      MemoLog.Lines.Add('Architecture : ' +
        PythonEngine1.EvalString('platform.machine()'));

      ButtonLoadModel.Enabled := True;
    end
    else
    begin
      LabelStatus.Caption := 'Erreur Python';
      LabelStatus.Font.Color := clRed;
      ShowMessage('Impossible d''initialiser Python');
    end;

  except
    on E: Exception do
    begin
      LabelStatus.Caption := 'Erreur : ' + E.Message;
      LabelStatus.Font.Color := clRed;
      ShowMessage('Erreur Python : ' + E.Message);
    end;
  end;
end;

procedure TFormClassifier.ButtonLoadModelClick(Sender: TObject);
begin
  ButtonLoadModel.Enabled := False;
  LabelStatus.Caption := 'Chargement du mod√®le...';
  Application.ProcessMessages;

  try
    LoadModel;
  finally
    ButtonLoadModel.Enabled := not FModelLoaded;
  end;
end;

procedure TFormClassifier.LoadModel;
begin
  try
    MemoLog.Lines.Add('');
    MemoLog.Lines.Add('=== Chargement du mod√®le ===');

    // Importer les biblioth√®ques
    PythonEngine1.ExecString('import tensorflow as tf');
    PythonEngine1.ExecString('import numpy as np');
    PythonEngine1.ExecString('from PIL import Image');

    MemoLog.Lines.Add('‚úì TensorFlow import√©');

    // Charger le mod√®le MobileNetV2 pr√©-entra√Æn√©
    PythonEngine1.ExecString(
      'model = tf.keras.applications.MobileNetV2(' +
      'weights="imagenet", include_top=True)'
    );

    MemoLog.Lines.Add('‚úì Mod√®le MobileNetV2 charg√©');

    // Pr√©parer les fonctions de traitement
    PythonEngine1.ExecString(
      'preprocess = tf.keras.applications.mobilenet_v2.preprocess_input'
    );
    PythonEngine1.ExecString(
      'decode = tf.keras.applications.mobilenet_v2.decode_predictions'
    );

    FModelLoaded := True;
    LabelStatus.Caption := 'Mod√®le pr√™t';
    LabelStatus.Font.Color := clGreen;

    ButtonSelectImage.Enabled := True;

    MemoLog.Lines.Add('‚úì Pr√™t pour la classification');

  except
    on E: Exception do
    begin
      FModelLoaded := False;
      LabelStatus.Caption := 'Erreur chargement';
      LabelStatus.Font.Color := clRed;

      MemoLog.Lines.Add('‚úó Erreur : ' + E.Message);

      ShowMessage('Erreur lors du chargement du mod√®le :' + LineEnding +
                  E.Message + LineEnding + LineEnding +
                  'Installez TensorFlow avec :' + LineEnding +
                  'pip3 install tensorflow pillow');
    end;
  end;
end;

procedure TFormClassifier.ButtonSelectImageClick(Sender: TObject);
begin
  if OpenPictureDialog.Execute then
  begin
    FCurrentImage := OpenPictureDialog.FileName;

    try
      ImagePreview.Picture.LoadFromFile(FCurrentImage);
      ButtonClassify.Enabled := True;
      LabelResult.Caption := 'R√©sultat : (en attente)';

      MemoLog.Lines.Add('');
      MemoLog.Lines.Add('Image s√©lectionn√©e : ' +
        ExtractFileName(FCurrentImage));

    except
      on E: Exception do
        ShowMessage('Erreur chargement image : ' + E.Message);
    end;
  end;
end;

procedure TFormClassifier.ButtonClassifyClick(Sender: TObject);
begin
  if not FModelLoaded then
  begin
    ShowMessage('Veuillez d''abord charger le mod√®le !');
    Exit;
  end;

  if FCurrentImage = '' then
  begin
    ShowMessage('Veuillez d''abord s√©lectionner une image !');
    Exit;
  end;

  ButtonClassify.Enabled := False;
  LabelStatus.Caption := 'Classification en cours...';
  Application.ProcessMessages;

  try
    ClassifyImage;
  finally
    ButtonClassify.Enabled := True;
    LabelStatus.Caption := 'Pr√™t';
  end;
end;

procedure TFormClassifier.ClassifyImage;
var
  PredictionClass: string;
  PredictionScore: string;
  Score: Double;
begin
  try
    MemoLog.Lines.Add('');
    MemoLog.Lines.Add('=== Classification ===');

    // Charger et pr√©traiter l'image
    PythonEngine1.ExecString(
      Format('img = Image.open(r"%s")', [FCurrentImage])
    );
    PythonEngine1.ExecString('img = img.resize((224, 224))');
    PythonEngine1.ExecString('img_array = np.array(img)');
    PythonEngine1.ExecString('img_array = np.expand_dims(img_array, axis=0)');
    PythonEngine1.ExecString('img_array = preprocess(img_array)');

    MemoLog.Lines.Add('‚úì Image pr√©trait√©e');

    // Faire la pr√©diction
    PythonEngine1.ExecString('predictions = model.predict(img_array, verbose=0)');
    PythonEngine1.ExecString('decoded = decode(predictions, top=1)[0][0]');

    // R√©cup√©rer les r√©sultats
    PythonEngine1.ExecString('class_name = decoded[1]');
    PythonEngine1.ExecString('confidence = float(decoded[2])');

    PredictionClass := PythonEngine1.EvalString('class_name');
    PredictionScore := PythonEngine1.EvalString('str(confidence)');

    Score := StrToFloat(PredictionScore);

    // Afficher le r√©sultat
    LabelResult.Caption := Format('R√©sultat : %s (%.1f%%)',
      [PredictionClass, Score * 100]);
    LabelResult.Font.Color := clGreen;
    LabelResult.Font.Style := [fsBold];

    MemoLog.Lines.Add(Format('‚úì Pr√©diction : %s', [PredictionClass]));
    MemoLog.Lines.Add(Format('‚úì Confiance : %.1f%%', [Score * 100]));

    // Obtenir le top 3
    PythonEngine1.ExecString('decoded_top3 = decode(predictions, top=3)[0]');
    PythonEngine1.ExecString(
      'top3_str = "\\n".join([f"{i+1}. {p[1]} ({p[2]*100:.1f}%)" ' +
      'for i, p in enumerate(decoded_top3)])'
    );

    var Top3 := PythonEngine1.EvalString('top3_str');

    ShowMessage('Top 3 pr√©dictions :' + LineEnding + LineEnding + Top3);

  except
    on E: Exception do
    begin
      LabelResult.Caption := 'Erreur de classification';
      LabelResult.Font.Color := clRed;

      MemoLog.Lines.Add('‚úó Erreur : ' + E.Message);
      ShowMessage('Erreur : ' + E.Message);
    end;
  end;
end;

procedure TFormClassifier.PythonGUIInputOutput1SendData(Sender: TObject;
  const Data: string);
begin
  if Trim(Data) <> '' then
    MemoLog.Lines.Add('[Python] ' + Data);
end;

end.
```

## Utilisation du GPU sur Ubuntu

### Installation des pilotes NVIDIA

Pour utiliser TensorFlow avec GPU sur Ubuntu :

**√âtape 1 : V√©rifier la carte graphique**

```bash
lspci | grep -i nvidia
```

**√âtape 2 : Installer les pilotes NVIDIA**

```bash
# M√©thode recommand√©e (via ubuntu-drivers)
sudo ubuntu-drivers autoinstall

# Red√©marrer
sudo reboot

# V√©rifier l'installation
nvidia-smi
```

**Sortie attendue de nvidia-smi :**
```
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 525.125.06   Driver Version: 525.125.06   CUDA Version: 12.0     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  NVIDIA GeForce ... Off   | 00000000:01:00.0 Off |                  N/A |
| 30%   42C    P0    N/A /  N/A |      0MiB /  8192MiB |      0%      Default |
+-------------------------------+----------------------+----------------------+
```

**√âtape 3 : Installer CUDA Toolkit**

```bash
# Pour Ubuntu 22.04
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-ubuntu2204.pin
sudo mv cuda-ubuntu2204.pin /etc/apt/preferences.d/cuda-repository-pin-600
wget https://developer.download.nvidia.com/compute/cuda/12.0.0/local_installers/cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb
sudo dpkg -i cuda-repo-ubuntu2204-12-0-local_12.0.0-525.60.13-1_amd64.deb
sudo cp /var/cuda-repo-ubuntu2204-12-0-local/cuda-*-keyring.gpg /usr/share/keyrings/
sudo apt-get update
sudo apt-get -y install cuda
```

**√âtape 4 : Installer cuDNN**

```bash
# T√©l√©charger depuis https://developer.nvidia.com/cudnn (n√©cessite un compte)
# Puis :
sudo dpkg -i cudnn-local-repo-ubuntu2204-8.x.x.x_1.0-1_amd64.deb
sudo cp /var/cudnn-local-repo-*/cudnn-local-*-keyring.gpg /usr/share/keyrings/
sudo apt-get update
sudo apt-get install libcudnn8 libcudnn8-dev
```

**√âtape 5 : Installer TensorFlow GPU**

```bash
pip3 install tensorflow[and-cuda]
# ou pour une version sp√©cifique
pip3 install tensorflow-gpu==2.13.0
```

**√âtape 6 : Tester le GPU dans votre application**

```pascal
procedure TForm1.TestGPUClick(Sender: TObject);
var
  GPUAvailable: string;
  GPUDevices: string;
begin
  try
    PythonEngine1.ExecString('import tensorflow as tf');

    // V√©rifier la disponibilit√© du GPU
    PythonEngine1.ExecString('gpu_available = len(tf.config.list_physical_devices("GPU")) > 0');
    GPUAvailable := PythonEngine1.EvalString('str(gpu_available)');

    if GPUAvailable = 'True' then
    begin
      MemoLog.Lines.Add('‚úì GPU disponible !');

      // Lister les GPU
      PythonEngine1.ExecString('gpus = tf.config.list_physical_devices("GPU")');
      PythonEngine1.ExecString('gpu_names = [gpu.name for gpu in gpus]');
      GPUDevices := PythonEngine1.EvalString('str(gpu_names)');

      MemoLog.Lines.Add('GPU(s) : ' + GPUDevices);

      // Test de calcul sur GPU
      PythonEngine1.ExecString(
        'with tf.device("/GPU:0"):' + LineEnding +
        '    a = tf.constant([[1.0, 2.0], [3.0, 4.0]])' + LineEnding +
        '    b = tf.constant([[1.0, 1.0], [0.0, 1.0]])' + LineEnding +
        '    c = tf.matmul(a, b)' + LineEnding +
        '    print("Calcul sur GPU r√©ussi:", c.numpy())'
      );
    end
    else
    begin
      MemoLog.Lines.Add('‚úó Aucun GPU d√©tect√©');
      MemoLog.Lines.Add('TensorFlow utilisera le CPU');
    end;

  except
    on E: Exception do
      ShowMessage('Erreur test GPU : ' + E.Message);
  end;
end;
```

### Configuration de la m√©moire GPU

```pascal
procedure TForm1.ConfigureGPUMemory;
begin
  // Permettre la croissance dynamique de la m√©moire GPU
  PythonEngine1.ExecString('import tensorflow as tf');
  PythonEngine1.ExecString(
    'gpus = tf.config.list_physical_devices("GPU")' + LineEnding +
    'if gpus:' + LineEnding +
    '    for gpu in gpus:' + LineEnding +
    '        tf.config.experimental.set_memory_growth(gpu, True)'
  );

  // Ou limiter la m√©moire GPU √† 4GB
  PythonEngine1.ExecString(
    'if gpus:' + LineEnding +
    '    tf.config.set_logical_device_configuration(' + LineEnding +
    '        gpus[0],' + LineEnding +
    '        [tf.config.LogicalDeviceConfiguration(memory_limit=4096)]' + LineEnding +
    '    )'
  );
end;
```

## Scripts shell et automatisation

### Script d'installation des d√©pendances

Cr√©ez un fichier `install_dependencies.sh` :

```bash
#!/bin/bash

echo "=== Installation des d√©pendances Python pour l'IA ==="

# Mise √† jour du syst√®me
echo "Mise √† jour du syst√®me..."
sudo apt update

# Installation de Python et outils
echo "Installation de Python et pip..."
sudo apt install -y python3 python3-pip python3-dev python3-venv

# Installation des biblioth√®ques IA
echo "Installation des biblioth√®ques IA..."
pip3 install --upgrade pip
pip3 install numpy pandas matplotlib seaborn
pip3 install scikit-learn xgboost
pip3 install tensorflow
pip3 install torch torchvision
pip3 install opencv-python pillow
pip3 install transformers spacy

# Installation de Jupyter (optionnel)
echo "Installation de Jupyter..."
pip3 install jupyter notebook

# V√©rification
echo ""
echo "=== V√©rification des installations ==="
python3 -c "import numpy; print('NumPy:', numpy.__version__)"
python3 -c "import pandas; print('Pandas:', pandas.__version__)"
python3 -c "import tensorflow; print('TensorFlow:', tensorflow.__version__)"

echo ""
echo "Installation termin√©e !"
```

**Rendre le script ex√©cutable et l'ex√©cuter :**

```bash
chmod +x install_dependencies.sh
./install_dependencies.sh
```

### Script de lancement de l'application

Cr√©ez `launch_app.sh` :

```bash
#!/bin/bash

# Activer l'environnement virtuel si n√©cessaire
if [ -d "venv" ]; then
    source venv/bin/activate
fi

# D√©finir les variables d'environnement
export PYTHONPATH="${PYTHONPATH}:$(pwd)/python_scripts"
export TF_CPP_MIN_LOG_LEVEL=2  # R√©duire les logs TensorFlow

# Lancer l'application
./MonApplication

# D√©sactiver l'environnement virtuel
if [ -d "venv" ]; then
    deactivate
fi
```

**Utilisation :**

```bash
chmod +x launch_app.sh
./launch_app.sh
```

### Int√©gration dans l'application Lazarus

```pascal
procedure TForm1.ButtonInstallDependenciesClick(Sender: TObject);
var
  Process: TProcess;
  ScriptPath: string;
begin
  ScriptPath := ExtractFilePath(Application.ExeName) + 'install_dependencies.sh';

  if not FileExists(ScriptPath) then
  begin
    ShowMessage('Script d''installation introuvable !');
    Exit;
  end;

  Process := TProcess.Create(nil);
  try
    Process.Executable := 'x-terminal-emulator';
    Process.Parameters.Add('-e');
    Process.Parameters.Add('bash');
    Process.Parameters.Add(ScriptPath);
    Process.Execute;

    ShowMessage('Installation lanc√©e dans un terminal');
  finally
    Process.Free;
  end;
end;
```

## Environnements virtuels Python

### Cr√©er et utiliser un venv

**Cr√©er un environnement virtuel :**

```bash
# Dans le dossier de votre projet
python3 -m venv venv

# Activer
source venv/bin/activate

# Installer les d√©pendances
pip install tensorflow numpy pandas

# D√©sactiver
deactivate
```

**Utiliser le venv dans votre application Lazarus :**

```pascal
procedure TForm1.UseVirtualEnvironment;
var
  VenvPath: string;
  PythonExe: string;
  LibPath: string;
begin
  // Chemin vers l'environnement virtuel
  VenvPath := ExtractFilePath(Application.ExeName) + 'venv';

  if not DirectoryExists(VenvPath) then
  begin
    ShowMessage('Environnement virtuel introuvable !');
    Exit;
  end;

  // Configurer PythonEngine pour utiliser le venv
  PythonExe := VenvPath + '/bin/python3';
  LibPath := VenvPath + '/lib';

  // Trouver libpython dans le venv
  PythonEngine1.DllPath := LibPath;
  PythonEngine1.DllName := 'libpython3.10.so';  // Adapter selon version
  PythonEngine1.LoadDll;

  if PythonEngine1.Initialized then
  begin
    // Ajouter le site-packages du venv au path
    PythonEngine1.ExecString('import sys');
    PythonEngine1.ExecString(
      Format('sys.path.insert(0, "%s/lib/python3.10/site-packages")', [VenvPath])
    );

    ShowMessage('Environnement virtuel charg√© !');
  end;
end;
```

### Cr√©er un venv depuis l'application

```pascal
procedure TForm1.CreateVirtualEnvironment;
var
  Process: TProcess;
  VenvPath: string;
begin
  VenvPath := ExtractFilePath(Application.ExeName) + 'venv';

  if DirectoryExists(VenvPath) then
  begin
    if MessageDlg('Un environnement existe d√©j√†. Recr√©er ?',
                  mtConfirmation, [mbYes, mbNo], 0) = mrNo then
      Exit;

    DeleteDirectory(VenvPath, True);
  end;

  Process := TProcess.Create(nil);
  try
    Process.Executable := 'python3';
    Process.Parameters.Add('-m');
    Process.Parameters.Add('venv');
    Process.Parameters.Add(VenvPath);
    Process.Options := [poWaitOnExit];
    Process.Execute;

    if Process.ExitStatus = 0 then
      ShowMessage('Environnement virtuel cr√©√© !' + LineEnding +
                  'Chemin : ' + VenvPath)
    else
      ShowMessage('Erreur lors de la cr√©ation');

  finally
    Process.Free;
  end;
end;
```

## D√©ploiement sur Ubuntu

### Structure de d√©ploiement recommand√©e

```
MonApplication/
‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îî‚îÄ‚îÄ MonApplication              # Ex√©cutable
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ x86_64-linux-gnu/          # Biblioth√®ques si n√©cessaire
‚îú‚îÄ‚îÄ share/
‚îÇ   ‚îú‚îÄ‚îÄ scripts/                   # Scripts Python
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ preprocessing.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îÇ   ‚îú‚îÄ‚îÄ models/                    # Mod√®les ML
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trained_model.h5
‚îÇ   ‚îî‚îÄ‚îÄ data/                      # Donn√©es
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ app.conf                   # Configuration
‚îú‚îÄ‚îÄ install.sh                     # Script d'installation
‚îú‚îÄ‚îÄ uninstall.sh                   # Script de d√©sinstallation
‚îú‚îÄ‚îÄ requirements.txt               # D√©pendances Python
‚îî‚îÄ‚îÄ README.md                      # Documentation
```

### Fichier requirements.txt

```
numpy>=1.24.0
pandas>=2.0.0
matplotlib>=3.7.0
scikit-learn>=1.3.0
tensorflow>=2.13.0
opencv-python>=4.8.0
pillow>=10.0.0
```

### Script d'installation - install.sh

```bash
#!/bin/bash

APP_NAME="MonApplication"
INSTALL_DIR="/opt/$APP_NAME"
BIN_DIR="/usr/local/bin"
DESKTOP_DIR="/usr/share/applications"

echo "=== Installation de $APP_NAME ==="

# V√©rifier les privil√®ges
if [ "$EUID" -ne 0 ]; then
    echo "Erreur : Ce script doit √™tre ex√©cut√© avec sudo"
    exit 1
fi

# Cr√©er les r√©pertoires
echo "Cr√©ation des r√©pertoires..."
mkdir -p "$INSTALL_DIR"/{bin,share,config}

# Copier les fichiers
echo "Copie des fichiers..."
cp -r bin/* "$INSTALL_DIR/bin/"
cp -r share/* "$INSTALL_DIR/share/"
cp -r config/* "$INSTALL_DIR/config/"

# Rendre l'ex√©cutable... ex√©cutable
chmod +x "$INSTALL_DIR/bin/$APP_NAME"

# Cr√©er un lien symbolique
ln -sf "$INSTALL_DIR/bin/$APP_NAME" "$BIN_DIR/$APP_NAME"

# Installer les d√©pendances Python
echo "Installation des d√©pendances Python..."
if [ -f "requirements.txt" ]; then
    pip3 install -r requirements.txt
fi

# Cr√©er un fichier .desktop
cat > "$DESKTOP_DIR/$APP_NAME.desktop" <<EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=$APP_NAME
Comment=Application IA avec FreePascal
Exec=$BIN_DIR/$APP_NAME
Icon=$INSTALL_DIR/share/icon.png
Terminal=false
Categories=Science;Education;
EOF

echo ""
echo "Installation termin√©e !"
echo "Lancez l'application avec : $APP_NAME"
echo "Ou depuis le menu Applications"
```

**Utilisation :**

```bash
sudo ./install.sh
```

### Cr√©er un paquet .deb

**Structure du paquet :**

```
monapp-1.0/
‚îú‚îÄ‚îÄ DEBIAN/
‚îÇ   ‚îú‚îÄ‚îÄ control
‚îÇ   ‚îú‚îÄ‚îÄ postinst
‚îÇ   ‚îî‚îÄ‚îÄ prerm
‚îú‚îÄ‚îÄ opt/
‚îÇ   ‚îî‚îÄ‚îÄ MonApplication/
‚îÇ       ‚îú‚îÄ‚îÄ bin/
‚îÇ       ‚îî‚îÄ‚îÄ share/
‚îî‚îÄ‚îÄ usr/
    ‚îú‚îÄ‚îÄ bin/
    ‚îî‚îÄ‚îÄ share/
        ‚îî‚îÄ‚îÄ applications/
```

**Fichier DEBIAN/control :**

```
Package: monapp
Version: 1.0
Section: science
Priority: optional
Architecture: amd64
Depends: python3 (>= 3.8), python3-pip, libpython3.10
Maintainer: Votre Nom <email@example.com>
Description: Application d'IA avec FreePascal
 Application de Machine Learning d√©velopp√©e avec FreePascal
 et Python int√©gr√© via Python4Lazarus.
```

**Fichier DEBIAN/postinst :**

```bash
#!/bin/bash
set -e

# Installer les d√©pendances Python
pip3 install -r /opt/MonApplication/requirements.txt

echo "Installation de MonApplication termin√©e"
```

**Fichier DEBIAN/prerm :**

```bash
#!/bin/bash
set -e

echo "D√©sinstallation de MonApplication..."
```

**Construire le paquet :**

```bash
# Rendre les scripts ex√©cutables
chmod 755 DEBIAN/postinst DEBIAN/prerm

# Construire le .deb
dpkg-deb --build monapp-1.0

# Installer
sudo dpkg -i monapp-1.0.deb

# Ou d√©sinstaller
sudo dpkg -r monapp
```

### Cr√©er une AppImage

Une AppImage est un format portable qui fonctionne sur toutes les distributions Linux.

**Utiliser appimagetool :**

```bash
# T√©l√©charger appimagetool
wget https://github.com/AppImage/AppImageKit/releases/download/continuous/appimagetool-x86_64.AppImage
chmod +x appimagetool-x86_64.AppImage

# Structure de l'AppImage
mkdir -p MonApplication.AppDir/usr/{bin,lib,share}

# Copier les fichiers
cp bin/MonApplication MonApplication.AppDir/usr/bin/
cp -r share/* MonApplication.AppDir/usr/share/

# Cr√©er AppRun
cat > MonApplication.AppDir/AppRun <<'EOF'
#!/bin/bash
SELF=$(readlink -f "$0")
HERE=${SELF%/*}
export PATH="${HERE}/usr/bin:${PATH}"
export LD_LIBRARY_PATH="${HERE}/usr/lib:${LD_LIBRARY_PATH}"
export PYTHONPATH="${HERE}/usr/share/scripts:${PYTHONPATH}"
exec "${HERE}/usr/bin/MonApplication" "$@"
EOF

chmod +x MonApplication.AppDir/AppRun

# Cr√©er le .desktop
cp MonApplication.desktop MonApplication.AppDir/

# Cr√©er l'ic√¥ne
cp icon.png MonApplication.AppDir/

# Construire l'AppImage
./appimagetool-x86_64.AppImage MonApplication.AppDir

# R√©sultat : MonApplication-x86_64.AppImage
chmod +x MonApplication-x86_64.AppImage

# Ex√©cuter
./MonApplication-x86_64.AppImage
```

## D√©bogage avanc√© sur Ubuntu

### Utiliser gdb avec Python et Lazarus

```bash
# Compiler en mode debug
lazbuild --build-mode=Debug MonProjet.lpi

# Lancer avec gdb
gdb ./MonApplication

# Dans gdb
(gdb) run
(gdb) break Unit1.pas:42
(gdb) continue
(gdb) print variable
(gdb) backtrace
```

### Logs syst√®me

```pascal
uses
  Unix, BaseUnix;

procedure TForm1.LogToSyslog(const Message: string);
begin
  {$IFDEF LINUX}
  FpSyslog(LOG_INFO, PChar(Message));
  {$ENDIF}
end;

// Utilisation
LogToSyslog('Application d√©marr√©e');
LogToSyslog('Mod√®le ML charg√©');
```

**Voir les logs :**

```bash
journalctl -f | grep MonApplication
```

### Monitoring des ressources

```pascal
procedure TForm1.CheckResourceUsage;
var
  MemInfo: string;
begin
  // Utilisation m√©moire Python
  PythonEngine1.ExecString('import psutil');
  PythonEngine1.ExecString('import os');

  PythonEngine1.ExecString('process = psutil.Process(os.getpid())');
  PythonEngine1.ExecString('mem_info = process.memory_info()');
  PythonEngine1.ExecString('mem_mb = mem_info.rss / 1024 / 1024');

  MemInfo := PythonEngine1.EvalString('f"{mem_mb:.1f} MB"');

  LabelMemory.Caption := 'M√©moire : ' + MemInfo;
end;
```

## Conclusion et bonnes pratiques Ubuntu

### Points cl√©s √† retenir

‚úÖ **Installation** : Python3 pr√©-install√©, utiliser apt et pip  
‚úÖ **Chemins** : `/usr/lib`, `/usr/local`, utiliser `/` comme s√©parateur  
‚úÖ **Biblioth√®ques** : `.so` au lieu de `.dll`  
‚úÖ **Permissions** : G√©rer sudo et chmod correctement  
‚úÖ **GPU** : CUDA et cuDNN pour TensorFlow/PyTorch  
‚úÖ **D√©ploiement** : Scripts shell, .deb, AppImage  
‚úÖ **Environnements** : venv ou conda pour isolation

### Avantages d'Ubuntu pour l'IA

- Performance native des biblioth√®ques Python
- Meilleure gestion GPU/CUDA
- D√©ploiement serveur simplifi√©
- Conteneurisation native (Docker)
- Outils de d√©veloppement int√©gr√©s
- Communaut√© IA tr√®s active sur Linux

### Prochaines √©tapes

Vous ma√Ætrisez maintenant Python4Lazarus sur Ubuntu ! Vous pouvez :

1. Cr√©er des applications IA performantes
2. Utiliser le GPU pour le deep learning
3. D√©ployer facilement sur serveurs Linux
4. Empaqueter pour distribution (.deb, AppImage)
5. Combiner les avantages de Pascal et Python

# 15.7.2 Python4Lazarus sur Ubuntu (partie 3 - Finale)

## Projets complets d'exemple

### Projet 1 : Serveur d'IA avec interface de monitoring

Application compl√®te qui lance un serveur Flask Python et monitore son activit√© depuis Lazarus.

```pascal
unit AIServer;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, Forms, Controls, Graphics, Dialogs, StdCtrls, ExtCtrls,
  PythonEngine, PythonGUIInputOutput, Process, ComCtrls;

type
  TFormAIServer = class(TForm)
    ButtonStartServer: TButton;
    ButtonStopServer: TButton;
    ButtonTestAPI: TButton;
    EditPort: TEdit;
    LabelPort: TLabel;
    LabelStatus: TLabel;
    MemoLog: TMemo;
    ProgressBarLoad: TProgressBar;
    PythonEngine1: TPythonEngine;

    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure ButtonStartServerClick(Sender: TObject);
    procedure ButtonStopServerClick(Sender: TObject);
    procedure ButtonTestAPIClick(Sender: TObject);

  private
    FServerRunning: Boolean;
    FServerPort: Integer;
    procedure InitializePython;
    procedure StartFlaskServer;
    procedure StopFlaskServer;
    procedure TestAPIEndpoint;
    procedure UpdateStatus(const Status: string; IsRunning: Boolean);
  end;

var
  FormAIServer: TFormAIServer;

implementation

uses
  fphttpclient, fpjson, jsonparser;

{$R *.lfm}

procedure TFormAIServer.FormCreate(Sender: TObject);
begin
  FServerRunning := False;
  FServerPort := 5000;
  EditPort.Text := '5000';

  InitializePython;
end;

procedure TFormAIServer.FormDestroy(Sender: TObject);
begin
  if FServerRunning then
    StopFlaskServer;

  if PythonEngine1.Initialized then
    PythonEngine1.Finalize;
end;

procedure TFormAIServer.InitializePython;
begin
  try
    {$IFDEF LINUX}
    PythonEngine1.UseLastKnownVersion := True;
    PythonEngine1.AutoLoad := True;
    {$ENDIF}

    PythonEngine1.LoadDll;

    if PythonEngine1.Initialized then
    begin
      MemoLog.Lines.Add('‚úì Python ' + PythonEngine1.PyVersion + ' initialis√©');

      // V√©rifier Flask
      try
        PythonEngine1.ExecString('import flask');
        MemoLog.Lines.Add('‚úì Flask disponible');
        ButtonStartServer.Enabled := True;
      except
        MemoLog.Lines.Add('‚úó Flask non install√©');
        MemoLog.Lines.Add('  Installez avec : pip3 install flask');
        ButtonStartServer.Enabled := False;
      end;
    end
    else
    begin
      MemoLog.Lines.Add('‚úó Erreur initialisation Python');
    end;

  except
    on E: Exception do
      MemoLog.Lines.Add('‚úó Erreur : ' + E.Message);
  end;
end;

procedure TFormAIServer.ButtonStartServerClick(Sender: TObject);
begin
  FServerPort := StrToIntDef(EditPort.Text, 5000);
  StartFlaskServer;
end;

procedure TFormAIServer.StartFlaskServer;
var
  ServerCode: string;
begin
  try
    MemoLog.Lines.Add('');
    MemoLog.Lines.Add('=== D√©marrage du serveur ===');

    // Code du serveur Flask
    ServerCode :=
      'from flask import Flask, request, jsonify' + LineEnding +
      'import threading' + LineEnding +
      'import numpy as np' + LineEnding +
      '' + LineEnding +
      'app = Flask(__name__)' + LineEnding +
      '' + LineEnding +
      '@app.route("/")' + LineEnding +
      'def home():' + LineEnding +
      '    return jsonify({"status": "running", "service": "AI Server"})' + LineEnding +
      '' + LineEnding +
      '@app.route("/predict", methods=["POST"])' + LineEnding +
      'def predict():' + LineEnding +
      '    data = request.json' + LineEnding +
      '    # Simulation de pr√©diction' + LineEnding +
      '    result = {"prediction": "classe_A", "confidence": 0.87}' + LineEnding +
      '    return jsonify(result)' + LineEnding +
      '' + LineEnding +
      '@app.route("/health")' + LineEnding +
      'def health():' + LineEnding +
      '    return jsonify({"status": "healthy"})' + LineEnding +
      '' + LineEnding +
      'def run_server():' + LineEnding +
      Format('    app.run(host="0.0.0.0", port=%d, debug=False)', [FServerPort]) + LineEnding +
      '' + LineEnding +
      'server_thread = threading.Thread(target=run_server, daemon=True)' + LineEnding +
      'server_thread.start()';

    PythonEngine1.ExecString(ServerCode);

    FServerRunning := True;
    UpdateStatus(Format('Serveur actif sur le port %d', [FServerPort]), True);

    MemoLog.Lines.Add('‚úì Serveur d√©marr√©');
    MemoLog.Lines.Add(Format('  URL : http://localhost:%d', [FServerPort]));

    ButtonStartServer.Enabled := False;
    ButtonStopServer.Enabled := True;
    ButtonTestAPI.Enabled := True;
    EditPort.Enabled := False;

    // Attendre un peu que le serveur d√©marre
    Sleep(1000);

  except
    on E: Exception do
    begin
      MemoLog.Lines.Add('‚úó Erreur d√©marrage : ' + E.Message);
      FServerRunning := False;
    end;
  end;
end;

procedure TFormAIServer.ButtonStopServerClick(Sender: TObject);
begin
  StopFlaskServer;
end;

procedure TFormAIServer.StopFlaskServer;
begin
  FServerRunning := False;
  UpdateStatus('Serveur arr√™t√©', False);

  MemoLog.Lines.Add('');
  MemoLog.Lines.Add('‚úì Serveur arr√™t√©');

  ButtonStartServer.Enabled := True;
  ButtonStopServer.Enabled := False;
  ButtonTestAPI.Enabled := False;
  EditPort.Enabled := True;
end;

procedure TFormAIServer.ButtonTestAPIClick(Sender: TObject);
begin
  TestAPIEndpoint;
end;

procedure TFormAIServer.TestAPIEndpoint;
var
  HTTPClient: TFPHTTPClient;
  Response: string;
  JSONData: TJSONData;
  URL: string;
begin
  try
    MemoLog.Lines.Add('');
    MemoLog.Lines.Add('=== Test de l''API ===');

    HTTPClient := TFPHTTPClient.Create(nil);
    try
      // Test endpoint /
      URL := Format('http://localhost:%d/', [FServerPort]);
      MemoLog.Lines.Add('GET ' + URL);

      Response := HTTPClient.Get(URL);
      MemoLog.Lines.Add('R√©ponse : ' + Response);

      JSONData := GetJSON(Response);
      try
        MemoLog.Lines.Add('  Status : ' + JSONData.FindPath('status').AsString);
        MemoLog.Lines.Add('  Service : ' + JSONData.FindPath('service').AsString);
      finally
        JSONData.Free;
      end;

      // Test endpoint /health
      URL := Format('http://localhost:%d/health', [FServerPort]);
      MemoLog.Lines.Add('');
      MemoLog.Lines.Add('GET ' + URL);

      Response := HTTPClient.Get(URL);
      MemoLog.Lines.Add('R√©ponse : ' + Response);

      MemoLog.Lines.Add('');
      MemoLog.Lines.Add('‚úì Tests r√©ussis');

    finally
      HTTPClient.Free;
    end;

  except
    on E: Exception do
    begin
      MemoLog.Lines.Add('‚úó Erreur test : ' + E.Message);
      MemoLog.Lines.Add('  Le serveur est-il d√©marr√© ?');
    end;
  end;
end;

procedure TFormAIServer.UpdateStatus(const Status: string; IsRunning: Boolean);
begin
  LabelStatus.Caption := 'Status : ' + Status;

  if IsRunning then
  begin
    LabelStatus.Font.Color := clGreen;
    LabelStatus.Caption := LabelStatus.Caption + ' üü¢';
  end
  else
  begin
    LabelStatus.Font.Color := clRed;
    LabelStatus.Caption := LabelStatus.Caption + ' üî¥';
  end;
end;

end.
```

### Projet 2 : Analyseur de logs avec ML

Application qui analyse des fichiers de logs syst√®me et d√©tecte des anomalies.

```pascal
unit LogAnalyzer;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, Forms, Controls, Graphics, Dialogs, StdCtrls, ExtCtrls,
  ComCtrls, Grids, PythonEngine;

type
  TFormLogAnalyzer = class(TForm)
    ButtonLoadLog: TButton;
    ButtonAnalyze: TButton;
    ButtonExport: TButton;
    MemoLogContent: TMemo;
    StringGridResults: TStringGrid;
    ProgressBar1: TProgressBar;
    LabelStats: TLabel;
    PythonEngine1: TPythonEngine;

    procedure FormCreate(Sender: TObject);
    procedure ButtonLoadLogClick(Sender: TObject);
    procedure ButtonAnalyzeClick(Sender: TObject);
    procedure ButtonExportClick(Sender: TObject);

  private
    FLogPath: string;
    procedure InitializePython;
    procedure LoadSystemLog(const LogPath: string);
    procedure AnalyzeLog;
    procedure DisplayResults;
  end;

var
  FormLogAnalyzer: TFormLogAnalyzer;

implementation

{$R *.lfm}

procedure TFormLogAnalyzer.FormCreate(Sender: TObject);
begin
  InitializePython;

  // Configuration de la grille
  StringGridResults.ColCount := 4;
  StringGridResults.RowCount := 1;
  StringGridResults.Cells[0, 0] := 'Timestamp';
  StringGridResults.Cells[1, 0] := 'Type';
  StringGridResults.Cells[2, 0] := 'Message';
  StringGridResults.Cells[3, 0] := 'Score anomalie';
end;

procedure TFormLogAnalyzer.InitializePython;
begin
  try
    {$IFDEF LINUX}
    PythonEngine1.UseLastKnownVersion := True;
    PythonEngine1.LoadDll;
    {$ENDIF}

    if PythonEngine1.Initialized then
    begin
      // Importer les biblioth√®ques n√©cessaires
      PythonEngine1.ExecString('import pandas as pd');
      PythonEngine1.ExecString('import numpy as np');
      PythonEngine1.ExecString('from sklearn.ensemble import IsolationForest');
      PythonEngine1.ExecString('from sklearn.feature_extraction.text import TfidfVectorizer');
      PythonEngine1.ExecString('import re');

      ButtonLoadLog.Enabled := True;
    end;

  except
    on E: Exception do
      ShowMessage('Erreur Python : ' + E.Message);
  end;
end;

procedure TFormLogAnalyzer.ButtonLoadLogClick(Sender: TObject);
var
  OpenDialog: TOpenDialog;
begin
  OpenDialog := TOpenDialog.Create(nil);
  try
    OpenDialog.Filter := 'Fichiers log|*.log;*.txt|Tous|*.*';
    OpenDialog.InitialDir := '/var/log';

    if OpenDialog.Execute then
    begin
      FLogPath := OpenDialog.FileName;
      LoadSystemLog(FLogPath);
    end;
  finally
    OpenDialog.Free;
  end;
end;

procedure TFormLogAnalyzer.LoadSystemLog(const LogPath: string);
var
  LogLines: TStringList;
begin
  try
    LogLines := TStringList.Create;
    try
      LogLines.LoadFromFile(LogPath);

      MemoLogContent.Lines.Clear;
      MemoLogContent.Lines.AddStrings(LogLines);

      LabelStats.Caption := Format('%d lignes charg√©es', [LogLines.Count]);

      // Charger dans Python
      PythonEngine1.ExecString(
        Format('log_path = r"%s"', [LogPath])
      );
      PythonEngine1.ExecString(
        'with open(log_path, "r") as f:' + LineEnding +
        '    log_lines = f.readlines()'
      );

      ButtonAnalyze.Enabled := True;

    finally
      LogLines.Free;
    end;

  except
    on E: Exception do
      ShowMessage('Erreur chargement : ' + E.Message);
  end;
end;

procedure TFormLogAnalyzer.ButtonAnalyzeClick(Sender: TObject);
begin
  ButtonAnalyze.Enabled := False;
  ProgressBar1.Style := pbstMarquee;

  try
    AnalyzeLog;
    DisplayResults;
  finally
    ButtonAnalyze.Enabled := True;
    ProgressBar1.Style := pbstNormal;
  end;
end;

procedure TFormLogAnalyzer.AnalyzeLog;
begin
  try
    // Pr√©traitement des logs
    PythonEngine1.ExecString(
      '# Extraire timestamp, type et message' + LineEnding +
      'import re' + LineEnding +
      'pattern = r"(\w+\s+\d+\s+\d+:\d+:\d+)\s+(\w+)\s+(.*)"' + LineEnding +
      'parsed_logs = []' + LineEnding +
      'for line in log_lines:' + LineEnding +
      '    match = re.search(pattern, line)' + LineEnding +
      '    if match:' + LineEnding +
      '        parsed_logs.append({' + LineEnding +
      '            "timestamp": match.group(1),' + LineEnding +
      '            "type": match.group(2),' + LineEnding +
      '            "message": match.group(3)' + LineEnding +
      '        })'
    );

    // Cr√©er un DataFrame
    PythonEngine1.ExecString('df = pd.DataFrame(parsed_logs)');

    // Vectorisation TF-IDF
    PythonEngine1.ExecString(
      'if len(df) > 0:' + LineEnding +
      '    vectorizer = TfidfVectorizer(max_features=100)' + LineEnding +
      '    X = vectorizer.fit_transform(df["message"].fillna(""))' + LineEnding +
      '    ' + LineEnding +
      '    # D√©tection d''anomalies' + LineEnding +
      '    clf = IsolationForest(contamination=0.1, random_state=42)' + LineEnding +
      '    df["anomaly_score"] = clf.fit_predict(X.toarray())' + LineEnding +
      '    df["is_anomaly"] = df["anomaly_score"] == -1'
    );

    // R√©sum√©
    PythonEngine1.ExecString(
      'anomaly_count = df["is_anomaly"].sum()' + LineEnding +
      'total_count = len(df)'
    );

    var AnomalyCount := PythonEngine1.EvalString('str(anomaly_count)');
    var TotalCount := PythonEngine1.EvalString('str(total_count)');

    LabelStats.Caption := Format('Anomalies d√©tect√©es : %s / %s',
      [AnomalyCount, TotalCount]);

  except
    on E: Exception do
      ShowMessage('Erreur analyse : ' + E.Message);
  end;
end;

procedure TFormLogAnalyzer.DisplayResults;
var
  RowCount: Integer;
  i: Integer;
  Results: string;
  ResultLines, CellList: TStringList;
begin
  try
    // Obtenir le nombre de lignes
    RowCount := StrToInt(PythonEngine1.EvalString('str(len(df))'));

    if RowCount = 0 then
      Exit;

    StringGridResults.RowCount := RowCount + 1;

    // Remplir la grille (limiter √† 100 premi√®res anomalies)
    PythonEngine1.ExecString(
      'anomalies = df[df["is_anomaly"]].head(100)' + LineEnding +
      'result_rows = []' + LineEnding +
      'for _, row in anomalies.iterrows():' + LineEnding +
      '    result_rows.append("|".join([' + LineEnding +
      '        str(row["timestamp"]),' + LineEnding +
      '        str(row["type"]),' + LineEnding +
      '        str(row["message"][:50]),' + LineEnding +
      '        str(row["anomaly_score"])' + LineEnding +
      '    ]))'
    );

    PythonEngine1.ExecString('result_str = "\n".join(result_rows)');

    Results := PythonEngine1.EvalString('result_str');
    ResultLines := TStringList.Create;
    try
      ResultLines.Text := Results;

      for i := 0 to ResultLines.Count - 1 do
      begin
        if Trim(ResultLines[i]) = '' then
          Continue;

        CellList := TStringList.Create;
        try
          CellList.Delimiter := '|';
          CellList.StrictDelimiter := True;
          CellList.DelimitedText := ResultLines[i];

          if CellList.Count >= 4 then
          begin
            StringGridResults.Cells[0, i + 1] := CellList[0];
            StringGridResults.Cells[1, i + 1] := CellList[1];
            StringGridResults.Cells[2, i + 1] := CellList[2];
            StringGridResults.Cells[3, i + 1] := CellList[3];
          end;
        finally
          CellList.Free;
        end;
      end;
    finally
      ResultLines.Free;
    end;

    ButtonExport.Enabled := True;

  except
    on E: Exception do
      ShowMessage('Erreur affichage : ' + E.Message);
  end;
end;

procedure TFormLogAnalyzer.ButtonExportClick(Sender: TObject);
var
  SaveDialog: TSaveDialog;
  ExportPath: string;
begin
  SaveDialog := TSaveDialog.Create(nil);
  try
    SaveDialog.Filter := 'CSV|*.csv';
    SaveDialog.DefaultExt := 'csv';
    SaveDialog.FileName := 'anomalies.csv';

    if SaveDialog.Execute then
    begin
      ExportPath := SaveDialog.FileName;

      PythonEngine1.ExecString(
        Format('anomalies = df[df["is_anomaly"]]' + LineEnding +
               'anomalies.to_csv(r"%s", index=False)', [ExportPath])
      );

      ShowMessage('Export r√©ussi : ' + ExportPath);
    end;
  finally
    SaveDialog.Free;
  end;
end;

end.
```

### Projet 3 : Reconnaissance vocale en temps r√©el

Application utilisant Whisper pour la transcription vocale en temps r√©el.

```pascal
unit VoiceRecognition;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, Forms, Controls, Graphics, Dialogs, StdCtrls, ExtCtrls,
  PythonEngine, Process;

type
  TFormVoice = class(TForm)
    ButtonLoadModel: TButton;
    ButtonRecord: TButton;
    ButtonStop: TButton;
    ButtonTranscribe: TButton;
    MemoTranscription: TMemo;
    LabelStatus: TLabel;
    TimerRecording: TTimer;
    PythonEngine1: TPythonEngine;

    procedure FormCreate(Sender: TObject);
    procedure ButtonLoadModelClick(Sender: TObject);
    procedure ButtonRecordClick(Sender: TObject);
    procedure ButtonStopClick(Sender: TObject);
    procedure ButtonTranscribeClick(Sender: TObject);
    procedure TimerRecordingTimer(Sender: TObject);

  private
    FModelLoaded: Boolean;
    FRecording: Boolean;
    FRecordProcess: TProcess;
    FAudioFile: string;

    procedure InitializePython;
    procedure LoadWhisperModel;
    procedure StartRecording;
    procedure StopRecording;
    procedure TranscribeAudio;
  end;

var
  FormVoice: TFormVoice;

implementation

{$R *.lfm}

procedure TFormVoice.FormCreate(Sender: TObject);
begin
  FModelLoaded := False;
  FRecording := False;
  FAudioFile := GetTempDir + 'recording.wav';

  InitializePython;
end;

procedure TFormVoice.InitializePython;
begin
  try
    {$IFDEF LINUX}
    PythonEngine1.UseLastKnownVersion := True;
    PythonEngine1.LoadDll;
    {$ENDIF}

    if PythonEngine1.Initialized then
    begin
      LabelStatus.Caption := 'Python initialis√©';
      ButtonLoadModel.Enabled := True;
    end;

  except
    on E: Exception do
      ShowMessage('Erreur : ' + E.Message);
  end;
end;

procedure TFormVoice.ButtonLoadModelClick(Sender: TObject);
begin
  ButtonLoadModel.Enabled := False;
  LabelStatus.Caption := 'Chargement du mod√®le Whisper...';
  Application.ProcessMessages;

  LoadWhisperModel;
end;

procedure TFormVoice.LoadWhisperModel;
begin
  try
    // Importer Whisper
    PythonEngine1.ExecString('import whisper');

    MemoTranscription.Lines.Add('‚úì Whisper import√©');

    // Charger le mod√®le (base ou tiny pour plus rapide)
    LabelStatus.Caption := 'Chargement du mod√®le (peut prendre du temps)...';
    Application.ProcessMessages;

    PythonEngine1.ExecString('model = whisper.load_model("base")');

    FModelLoaded := True;
    LabelStatus.Caption := 'Mod√®le Whisper charg√© et pr√™t';
    ButtonRecord.Enabled := True;

    MemoTranscription.Lines.Add('‚úì Mod√®le charg√©');
    MemoTranscription.Lines.Add('');
    MemoTranscription.Lines.Add('Pr√™t pour l''enregistrement !');

  except
    on E: Exception do
    begin
      LabelStatus.Caption := 'Erreur chargement';
      ShowMessage('Erreur : ' + E.Message + LineEnding + LineEnding +
                  'Installez Whisper avec :' + LineEnding +
                  'pip3 install openai-whisper');
      ButtonLoadModel.Enabled := True;
    end;
  end;
end;

procedure TFormVoice.ButtonRecordClick(Sender: TObject);
begin
  StartRecording;
end;

procedure TFormVoice.StartRecording;
begin
  // Utiliser arecord (ALSA) pour enregistrer
  FRecordProcess := TProcess.Create(nil);
  try
    FRecordProcess.Executable := 'arecord';
    FRecordProcess.Parameters.Add('-f');
    FRecordProcess.Parameters.Add('cd');  // CD quality
    FRecordProcess.Parameters.Add('-t');
    FRecordProcess.Parameters.Add('wav');
    FRecordProcess.Parameters.Add(FAudioFile);

    FRecordProcess.Execute;

    FRecording := True;
    LabelStatus.Caption := 'Enregistrement en cours... üî¥';
    LabelStatus.Font.Color := clRed;

    ButtonRecord.Enabled := False;
    ButtonStop.Enabled := True;
    TimerRecording.Enabled := True;

    MemoTranscription.Lines.Add('');
    MemoTranscription.Lines.Add('üé§ Enregistrement d√©marr√©...');

  except
    on E: Exception do
    begin
      ShowMessage('Erreur enregistrement : ' + E.Message + LineEnding +
                  'Installez arecord avec : sudo apt install alsa-utils');
      FRecordProcess.Free;
    end;
  end;
end;

procedure TFormVoice.ButtonStopClick(Sender: TObject);
begin
  StopRecording;
end;

procedure TFormVoice.StopRecording;
begin
  if FRecordProcess <> nil then
  begin
    FRecordProcess.Terminate(0);
    Sleep(500);
    FRecordProcess.Free;
    FRecordProcess := nil;
  end;

  FRecording := False;
  TimerRecording.Enabled := False;

  LabelStatus.Caption := 'Enregistrement termin√©';
  LabelStatus.Font.Color := clGreen;

  ButtonRecord.Enabled := True;
  ButtonStop.Enabled := False;
  ButtonTranscribe.Enabled := True;

  MemoTranscription.Lines.Add('‚úì Enregistrement sauvegard√©');
end;

procedure TFormVoice.TimerRecordingTimer(Sender: TObject);
begin
  // Afficher un indicateur visuel pendant l'enregistrement
  if Pos('üî¥', LabelStatus.Caption) > 0 then
    LabelStatus.Caption := 'Enregistrement en cours...'
  else
    LabelStatus.Caption := 'Enregistrement en cours... üî¥';
end;

procedure TFormVoice.ButtonTranscribeClick(Sender: TObject);
begin
  ButtonTranscribe.Enabled := False;
  LabelStatus.Caption := 'Transcription en cours...';
  Application.ProcessMessages;

  try
    TranscribeAudio;
  finally
    ButtonTranscribe.Enabled := True;
    LabelStatus.Caption := 'Transcription termin√©e';
  end;
end;

procedure TFormVoice.TranscribeAudio;
var
  Transcription: string;
  Language: string;
begin
  try
    if not FileExists(FAudioFile) then
    begin
      ShowMessage('Fichier audio introuvable !');
      Exit;
    end;

    MemoTranscription.Lines.Add('');
    MemoTranscription.Lines.Add('=== Transcription ===');

    // Transcrire avec Whisper
    PythonEngine1.ExecString(
      Format('result = model.transcribe(r"%s", fp16=False)', [FAudioFile])
    );

    // R√©cup√©rer le texte
    PythonEngine1.ExecString('text = result["text"]');
    Transcription := PythonEngine1.EvalString('text');

    // R√©cup√©rer la langue
    PythonEngine1.ExecString('lang = result["language"]');
    Language := PythonEngine1.EvalString('lang');

    // Afficher
    MemoTranscription.Lines.Add('Langue d√©tect√©e : ' + Language);
    MemoTranscription.Lines.Add('');
    MemoTranscription.Lines.Add('Texte :');
    MemoTranscription.Lines.Add(Transcription);

  except
    on E: Exception do
      ShowMessage('Erreur transcription : ' + E.Message);
  end;
end;

end.
```

## Int√©gration avec les outils syst√®me Ubuntu

### Notifications syst√®me (notify-send)

```pascal
procedure TForm1.SendSystemNotification(const Title, Message: string);
var
  Process: TProcess;
begin
  Process := TProcess.Create(nil);
  try
    Process.Executable := 'notify-send';
    Process.Parameters.Add(Title);
    Process.Parameters.Add(Message);
    Process.Parameters.Add('--icon=dialog-information');
    Process.Execute;
  finally
    Process.Free;
  end;
end;

// Utilisation
SendSystemNotification('Analyse termin√©e', 'Aucune anomalie d√©tect√©e');
```

### Int√©gration avec systemd (services)

Cr√©er un fichier de service `/etc/systemd/system/monapp-ai.service` :

```ini
[Unit]
Description=Mon Application IA
After=network.target

[Service]
Type=simple
User=monuser
WorkingDirectory=/opt/MonApplication
ExecStart=/opt/MonApplication/bin/MonApplication --headless
Restart=on-failure
RestartSec=10

# Variables d'environnement Python
Environment="PYTHONPATH=/opt/MonApplication/scripts"
Environment="TF_CPP_MIN_LOG_LEVEL=2"

[Install]
WantedBy=multi-user.target
```

**Commandes systemd :**

```bash
# Recharger systemd
sudo systemctl daemon-reload

# Activer le service au d√©marrage
sudo systemctl enable monapp-ai

# D√©marrer le service
sudo systemctl start monapp-ai

# Voir le statut
sudo systemctl status monapp-ai

# Voir les logs
journalctl -u monapp-ai -f
```

### Cron jobs pour t√¢ches planifi√©es

```bash
# √âditer le crontab
crontab -e

# Ajouter une t√¢che (exemple : analyse quotidienne √† 2h du matin)
0 2 * * * /opt/MonApplication/bin/MonApplication --analyze-daily >> /var/log/monapp.log 2>&1

# T√¢che toutes les heures
0 * * * * /opt/MonApplication/bin/MonApplication --check-anomalies
```

**Supporter les arguments en ligne de commande dans votre app :**

```pascal
procedure TForm1.FormCreate(Sender: TObject);
var
  i: Integer;
  Param: string;
  HeadlessMode: Boolean;
begin
  HeadlessMode := False;

  // Parcourir les arguments
  for i := 1 to ParamCount do
  begin
    Param := ParamStr(i);

    if Param = '--headless' then
    begin
      HeadlessMode := True;
      Application.ShowMainForm := False;
    end
    else if Param = '--analyze-daily' then
    begin
      InitializePython;
      RunDailyAnalysis;
      Application.Terminate;
    end
    else if Param = '--check-anomalies' then
    begin
      InitializePython;
      CheckAnomalies;
      Application.Terminate;
    end
    else if Param = '--version' then
    begin
      WriteLn('MonApplication v1.0');
      WriteLn('Python: ' + GetPythonVersion);
      Application.Terminate;
    end
    else if Param = '--help' then
    begin
      WriteLn('Usage: MonApplication [options]');
      WriteLn('Options:');
      WriteLn('  --headless          Mode sans interface');
      WriteLn('  --analyze-daily     Analyse quotidienne');
      WriteLn('  --check-anomalies   V√©rification anomalies');
      WriteLn('  --version           Afficher la version');
      WriteLn('  --help              Afficher cette aide');
      Application.Terminate;
    end;
  end;

  if not HeadlessMode then
    InitializePython;
end;

procedure TForm1.RunDailyAnalysis;
begin
  // Code pour l'analyse quotidienne
  WriteLn('D√©marrage de l''analyse quotidienne...');

  try
    PythonEngine1.ExecString('from datetime import datetime');
    PythonEngine1.ExecString('import logging');
    PythonEngine1.ExecString('logging.basicConfig(filename="/var/log/monapp/daily.log")');

    // Votre logique d'analyse
    PythonEngine1.ExecString('print(f"Analyse lanc√©e √† {datetime.now()}")');

    WriteLn('Analyse termin√©e avec succ√®s');

  except
    on E: Exception do
      WriteLn('Erreur: ' + E.Message);
  end;
end;
```

### Int√©gration avec D-Bus

D-Bus permet la communication entre applications sur Ubuntu :

```pascal
uses
  Process;

procedure TForm1.SendDBusNotification(const Summary, Body: string);
var
  Process: TProcess;
begin
  Process := TProcess.Create(nil);
  try
    Process.Executable := 'dbus-send';
    Process.Parameters.Add('--session');
    Process.Parameters.Add('--type=method_call');
    Process.Parameters.Add('--dest=org.freedesktop.Notifications');
    Process.Parameters.Add('/org/freedesktop/Notifications');
    Process.Parameters.Add('org.freedesktop.Notifications.Notify');
    Process.Parameters.Add('string:MonApplication');
    Process.Parameters.Add('uint32:0');
    Process.Parameters.Add('string:');
    Process.Parameters.Add('string:' + Summary);
    Process.Parameters.Add('string:' + Body);
    Process.Parameters.Add('array:string:');
    Process.Parameters.Add('dict:string:string:');
    Process.Parameters.Add('int32:5000');

    Process.Execute;
  finally
    Process.Free;
  end;
end;

// Utilisation
SendDBusNotification('Analyse IA', 'Traitement termin√© avec succ√®s');
```

## Optimisations sp√©cifiques Ubuntu

### Utilisation de la m√©moire partag√©e

Pour des performances optimales avec de gros volumes de donn√©es :

```pascal
procedure TForm1.UseSharedMemory;
begin
  // Activer la m√©moire partag√©e pour numpy
  PythonEngine1.ExecString('import os');
  PythonEngine1.ExecString('os.environ["OPENBLAS_NUM_THREADS"] = "4"');
  PythonEngine1.ExecString('os.environ["MKL_NUM_THREADS"] = "4"');

  // Optimiser TensorFlow pour CPU
  PythonEngine1.ExecString('import tensorflow as tf');
  PythonEngine1.ExecString(
    'tf.config.threading.set_inter_op_parallelism_threads(4)' + LineEnding +
    'tf.config.threading.set_intra_op_parallelism_threads(4)'
  );
end;
```

### Profiling avec perf

Analyser les performances sur Ubuntu :

```bash
# Compiler avec informations de debug
lazbuild --build-mode=Debug MonProjet.lpi

# Profiler avec perf
perf record -g ./MonApplication

# Analyser les r√©sultats
perf report

# Voir les hotspots
perf top
```

### Surveillance de la consommation m√©moire

```pascal
procedure TForm1.MonitorMemoryUsage;
var
  MemUsage: string;
  CPUUsage: string;
begin
  try
    PythonEngine1.ExecString('import psutil');
    PythonEngine1.ExecString('import os');

    // M√©moire du processus
    PythonEngine1.ExecString(
      'process = psutil.Process(os.getpid())' + LineEnding +
      'mem_info = process.memory_info()' + LineEnding +
      'mem_mb = mem_info.rss / 1024 / 1024' + LineEnding +
      'cpu_percent = process.cpu_percent(interval=1)'
    );

    MemUsage := PythonEngine1.EvalString('f"{mem_mb:.1f}"');
    CPUUsage := PythonEngine1.EvalString('f"{cpu_percent:.1f}"');

    LabelStats.Caption := Format('M√©moire: %s MB | CPU: %s%%',
      [MemUsage, CPUUsage]);

    // Log si usage √©lev√©
    if StrToFloat(MemUsage) > 1000 then
    begin
      WriteLn('ATTENTION: Usage m√©moire √©lev√©: ' + MemUsage + ' MB');

      // Forcer le garbage collector Python
      PythonEngine1.ExecString('import gc');
      PythonEngine1.ExecString('gc.collect()');
    end;

  except
    on E: Exception do
      WriteLn('Erreur monitoring: ' + E.Message);
  end;
end;
```

## Gestion multi-utilisateurs

### Permissions et acc√®s fichiers

```pascal
function TForm1.CheckFilePermissions(const FilePath: string): Boolean;
var
  Info: stat;
begin
  Result := False;

  if FpStat(FilePath, Info) = 0 then
  begin
    // V√©rifier les permissions de lecture
    Result := (Info.st_mode and S_IRUSR) <> 0;

    if not Result then
      ShowMessage('Permissions insuffisantes pour lire: ' + FilePath);
  end
  else
    ShowMessage('Impossible d''acc√©der au fichier: ' + FilePath);
end;

procedure TForm1.SetFilePermissions(const FilePath: string; Mode: Integer);
begin
  if FpChmod(FilePath, Mode) <> 0 then
    ShowMessage('Erreur lors de la modification des permissions');
end;

// Utilisation
SetFilePermissions('/tmp/output.csv', &644); // rw-r--r--
```

### Configuration par utilisateur

```pascal
function TForm1.GetUserConfigPath: string;
var
  HomeDir: string;
begin
  HomeDir := GetEnvironmentVariable('HOME');
  Result := HomeDir + '/.config/MonApplication';

  // Cr√©er le dossier s'il n'existe pas
  if not DirectoryExists(Result) then
    CreateDir(Result);
end;

procedure TForm1.LoadUserConfig;
var
  ConfigPath: string;
  Config: TStringList;
begin
  ConfigPath := GetUserConfigPath + '/config.ini';

  if FileExists(ConfigPath) then
  begin
    Config := TStringList.Create;
    try
      Config.LoadFromFile(ConfigPath);

      // Charger la configuration
      FPythonPath := Config.Values['PythonPath'];
      FModelPath := Config.Values['ModelPath'];

    finally
      Config.Free;
    end;
  end;
end;

procedure TForm1.SaveUserConfig;
var
  ConfigPath: string;
  Config: TStringList;
begin
  ConfigPath := GetUserConfigPath + '/config.ini';

  Config := TStringList.Create;
  try
    Config.Add('PythonPath=' + FPythonPath);
    Config.Add('ModelPath=' + FModelPath);
    Config.Add('LastUsed=' + DateTimeToStr(Now));

    Config.SaveToFile(ConfigPath);
  finally
    Config.Free;
  end;
end;
```

## Tests et CI/CD sur Ubuntu

### Tests unitaires avec FPCUnit

```pascal
unit TestAIFunctions;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, fpcunit, testregistry, PythonEngine;

type
  TTestAI = class(TTestCase)
  private
    FPythonEngine: TPythonEngine;
  protected
    procedure SetUp; override;
    procedure TearDown; override;
  published
    procedure TestPythonInitialization;
    procedure TestModelLoading;
    procedure TestPrediction;
  end;

implementation

procedure TTestAI.SetUp;
begin
  FPythonEngine := TPythonEngine.Create(nil);
  FPythonEngine.UseLastKnownVersion := True;
  FPythonEngine.LoadDll;
end;

procedure TTestAI.TearDown;
begin
  if FPythonEngine.Initialized then
    FPythonEngine.Finalize;
  FPythonEngine.Free;
end;

procedure TTestAI.TestPythonInitialization;
begin
  AssertTrue('Python devrait √™tre initialis√©', FPythonEngine.Initialized);
  AssertTrue('Version Python devrait commencer par 3',
    Copy(FPythonEngine.PyVersion, 1, 1) = '3');
end;

procedure TTestAI.TestModelLoading;
begin
  try
    FPythonEngine.ExecString('import numpy as np');
    AssertTrue('NumPy devrait √™tre importable', True);
  except
    Fail('Impossible d''importer NumPy');
  end;
end;

procedure TTestAI.TestPrediction;
var
  Result: string;
begin
  FPythonEngine.ExecString('result = 2 + 2');
  Result := FPythonEngine.EvalString('str(result)');
  AssertEquals('2+2 devrait √©galer 4', '4', Result);
end;

initialization
  RegisterTest(TTestAI);

end.
```

**Ex√©cuter les tests :**

```bash
# Compiler les tests
lazbuild tests/TestSuite.lpi

# Ex√©cuter
./tests/TestSuite --all --format=plain

# Avec sortie XML pour CI
./tests/TestSuite --all --format=xml --output=test-results.xml
```

### GitHub Actions pour Ubuntu

Cr√©er `.github/workflows/ubuntu-build.yml` :

```yaml
name: Build Ubuntu

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
    - uses: actions/checkout@v3

    - name: Install Lazarus
      run: |
        sudo add-apt-repository ppa:lazarus-team/lazarus
        sudo apt-get update
        sudo apt-get install -y lazarus lcl fp-compiler

    - name: Install Python dependencies
      run: |
        sudo apt-get install -y python3 python3-pip python3-dev
        pip3 install numpy pandas tensorflow scikit-learn

    - name: Build application
      run: |
        lazbuild --build-all --build-mode=Release MonProjet.lpi

    - name: Run tests
      run: |
        lazbuild tests/TestSuite.lpi
        ./tests/TestSuite --all --format=xml --output=test-results.xml

    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-results
        path: test-results.xml

    - name: Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: ubuntu-build
        path: bin/MonApplication
```

### GitLab CI pour Ubuntu

Cr√©er `.gitlab-ci.yml` :

```yaml
image: ubuntu:22.04

variables:
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - build
  - test
  - deploy

before_script:
  - apt-get update -qq
  - apt-get install -y -qq lazarus lcl fp-compiler python3 python3-pip
  - pip3 install numpy pandas tensorflow scikit-learn

build:
  stage: build
  script:
    - lazbuild --build-all --build-mode=Release MonProjet.lpi
  artifacts:
    paths:
      - bin/MonApplication
    expire_in: 1 week

test:
  stage: test
  script:
    - lazbuild tests/TestSuite.lpi
    - ./tests/TestSuite --all --format=xml --output=test-results.xml
  artifacts:
    reports:
      junit: test-results.xml

deploy:
  stage: deploy
  only:
    - main
  script:
    - dpkg-deb --build package/
    - cp package.deb MonApplication-${CI_COMMIT_TAG}.deb
  artifacts:
    paths:
      - MonApplication-${CI_COMMIT_TAG}.deb
```

## Docker et conteneurisation

### Dockerfile pour application Ubuntu

```dockerfile
FROM ubuntu:22.04

# √âviter les prompts interactifs
ENV DEBIAN_FRONTEND=noninteractive

# Installer les d√©pendances
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    libpython3.10 \
    && rm -rf /var/lib/apt/lists/*

# Installer les biblioth√®ques Python
RUN pip3 install --no-cache-dir \
    numpy \
    pandas \
    tensorflow \
    scikit-learn

# Cr√©er un utilisateur non-root
RUN useradd -m -s /bin/bash appuser

# Copier l'application
COPY --chown=appuser:appuser bin/MonApplication /opt/MonApplication/
COPY --chown=appuser:appuser share/ /opt/MonApplication/share/
COPY --chown=appuser:appuser config/ /opt/MonApplication/config/

# D√©finir les permissions
RUN chmod +x /opt/MonApplication/MonApplication

# Basculer vers l'utilisateur non-root
USER appuser

# D√©finir le r√©pertoire de travail
WORKDIR /opt/MonApplication

# Point d'entr√©e
ENTRYPOINT ["./MonApplication"]
CMD ["--headless"]
```

**Construire et ex√©cuter :**

```bash
# Construire l'image
docker build -t monapp:latest .

# Ex√©cuter
docker run -it --rm monapp:latest

# Avec volume pour les donn√©es
docker run -it --rm \
  -v $(pwd)/data:/data \
  monapp:latest --analyze /data/input.csv

# Avec GPU (NVIDIA)
docker run -it --rm --gpus all \
  monapp:latest
```

### Docker Compose pour stack compl√®te

```yaml
version: '3.8'

services:
  app:
    build: .
    image: monapp:latest
    container_name: monapp
    restart: unless-stopped
    environment:
      - PYTHONPATH=/opt/MonApplication/scripts
      - TF_CPP_MIN_LOG_LEVEL=2
    volumes:
      - ./data:/data
      - ./logs:/var/log/monapp
    ports:
      - "5000:5000"
    networks:
      - app-network

  postgres:
    image: postgres:15
    container_name: monapp-db
    restart: unless-stopped
    environment:
      - POSTGRES_DB=monapp
      - POSTGRES_USER=monapp
      - POSTGRES_PASSWORD=secret
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - app-network

  redis:
    image: redis:7-alpine
    container_name: monapp-cache
    restart: unless-stopped
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  postgres-data:
```

## Comparaison Windows vs Ubuntu

### Tableau r√©capitulatif

| Aspect | Windows | Ubuntu |
|--------|---------|--------|
| **Installation Python** | T√©l√©charger depuis python.org | Pr√©-install√© (`python3`) |
| **Gestionnaire de paquets** | pip, chocolatey | apt, pip, snap |
| **Biblioth√®ques dynamiques** | `.dll` | `.so` |
| **S√©parateur de chemin** | `\` | `/` |
| **Chemin Python typique** | `C:\Python310` | `/usr/bin/python3` |
| **Librairie Python** | `python310.dll` | `libpython3.10.so` |
| **Performance ML/IA** | Bonne | Excellente (natif) |
| **Support GPU** | Bon (CUDA) | Excellent (CUDA natif) |
| **D√©ploiement serveur** | IIS, services Windows | systemd, native |
| **Conteneurisation** | WSL2 requis | Natif |
| **Outils syst√®me** | Registry, WMI | D-Bus, systemd |
| **Permissions** | UAC | chmod, sudo |
| **Environnements virtuels** | venv, conda | venv, conda (natif) |

### Code multi-plateforme unifi√©

```pascal
unit CrossPlatformAI;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, PythonEngine
  {$IFDEF UNIX}, BaseUnix{$ENDIF}
  {$IFDEF WINDOWS}, Windows{$ENDIF};

type
  TPlatformHelper = class
  public
    class function GetPythonPath: string;
    class function GetPythonLibrary: string;
    class function GetConfigPath: string;
    class function GetTempPath: string;
    class function PathSeparator: Char;
    class function ExecuteCommand(const Cmd: string): string;
  end;

implementation

class function TPlatformHelper.GetPythonPath: string;
begin
  {$IFDEF WINDOWS}
  Result := 'C:\Python310';
  {$ENDIF}
  {$IFDEF UNIX}
  Result := '/usr/bin';
  {$ENDIF}
end;

class function TPlatformHelper.GetPythonLibrary: string;
begin
  {$IFDEF WINDOWS}
  Result := 'python310.dll';
  {$ENDIF}
  {$IFDEF UNIX}
  Result := 'libpython3.10.so';
  {$ENDIF}
end;

class function TPlatformHelper.GetConfigPath: string;
begin
  {$IFDEF WINDOWS}
  Result := GetEnvironmentVariable('APPDATA') + '\MonApplication';
  {$ENDIF}
  {$IFDEF UNIX}
  Result := GetEnvironmentVariable('HOME') + '/.config/MonApplication';
  {$ENDIF}

  if not DirectoryExists(Result) then
    CreateDir(Result);
end;

class function TPlatformHelper.GetTempPath: string;
begin
  {$IFDEF WINDOWS}
  Result := GetEnvironmentVariable('TEMP') + '\';
  {$ENDIF}
  {$IFDEF UNIX}
  Result := '/tmp/';
  {$ENDIF}
end;

class function TPlatformHelper.PathSeparator: Char;
begin
  {$IFDEF WINDOWS}
  Result := '\';
  {$ENDIF}
  {$IFDEF UNIX}
  Result := '/';
  {$ENDIF}
end;

class function TPlatformHelper.ExecuteCommand(const Cmd: string): string;
var
  Process: TProcess;
  Output: TStringList;
begin
  Process := TProcess.Create(nil);
  Output := TStringList.Create;
  try
    {$IFDEF WINDOWS}
    Process.Executable := 'cmd.exe';
    Process.Parameters.Add('/c');
    {$ENDIF}
    {$IFDEF UNIX}
    Process.Executable := '/bin/bash';
    Process.Parameters.Add('-c');
    {$ENDIF}

    Process.Parameters.Add(Cmd);
    Process.Options := [poWaitOnExit, poUsePipes];
    Process.Execute;

    Output.LoadFromStream(Process.Output);
    Result := Output.Text;

  finally
    Output.Free;
    Process.Free;
  end;
end;

end.
```

## R√©capitulatif et conclusion

### Points cl√©s Ubuntu

‚úÖ **Installation simple** : Python pr√©-install√©, apt pour les d√©pendances  
‚úÖ **Performance native** : Biblioth√®ques optimis√©es pour Linux  
‚úÖ **GPU** : Support CUDA/cuDNN excellent  
‚úÖ **D√©ploiement** : systemd, docker natif, .deb, AppImage  
‚úÖ **Outils syst√®me** : D-Bus, cron, journalctl int√©gr√©s  
‚úÖ **Serveurs** : Id√©al pour d√©ploiement production  
‚úÖ **Open Source** : √âcosyst√®me coh√©rent et gratuit

### Workflow complet Ubuntu

```
1. D√©veloppement
   ‚îú‚îÄ Lazarus IDE
   ‚îú‚îÄ Python3 + venv
   ‚îú‚îÄ Git pour versioning
   ‚îî‚îÄ Tests unitaires FPCUnit

2. Build
   ‚îú‚îÄ lazbuild (ligne de commande)
   ‚îú‚îÄ CI/CD (GitHub Actions/GitLab)
   ‚îî‚îÄ Tests automatis√©s

3. Packaging
   ‚îú‚îÄ .deb pour distributions Debian/Ubuntu
   ‚îú‚îÄ AppImage pour portabilit√©
   ‚îî‚îÄ Docker pour conteneurisation

4. D√©ploiement
   ‚îú‚îÄ systemd service
   ‚îú‚îÄ Nginx reverse proxy
   ‚îú‚îÄ Monitoring (Prometheus)
   ‚îî‚îÄ Logs (journalctl)
```

### Ressources Ubuntu sp√©cifiques

**Documentation :**
- Ubuntu Developers : [ubuntu.com/desktop/developers](https://ubuntu.com/desktop/developers)
- Python Packaging : [packaging.python.org](https://packaging.python.org)
- Lazarus Wiki : [wiki.lazarus.freepascal.org](https://wiki.lazarus.freepascal.org)

**Outils :**
```bash
# Outils de d√©veloppement essentiels
sudo apt install build-essential gdb valgrind

# Outils Python
sudo apt install python3-dev python3-venv ipython3

# Outils syst√®me
sudo apt install htop iotop nethogs
```

**Communaut√© :**
- Ask Ubuntu : [askubuntu.com](https://askubuntu.com)
- Forum Lazarus : Section Linux/Unix
- Stack Overflow : Tags "freepascal" + "ubuntu"

### Prochaines √©tapes

Vous ma√Ætrisez maintenant Python4Lazarus sur Ubuntu ! Vous √™tes capable de :

1. ‚úÖ Installer et configurer Python et Lazarus sur Ubuntu
2. ‚úÖ Cr√©er des applications IA performantes
3. ‚úÖ Utiliser le GPU pour le deep learning
4. ‚úÖ D√©ployer sur serveurs Linux
5. ‚úÖ Cr√©er des packages .deb et AppImage
6. ‚úÖ Int√©grer avec systemd et outils syst√®me
7. ‚úÖ Mettre en place CI/CD
8. ‚úÖ Conteneuriser avec Docker

**F√©licitations !** Vous avez termin√© l'√©tude compl√®te de Python4Lazarus sur Windows et Ubuntu. Vous pouvez maintenant d√©velopper des applications d'Intelligence Artificielle multi-plateformes professionnelles avec FreePascal ! üêßüêçüéâ

‚è≠Ô∏è [ONNX et mod√®les portables](/15-intelligence-artificielle-machine-learning/08-onnx-modeles-portables.md)
